import{a as i,b as p,q as b,r as C}from"./chunk-VGTTCDMY.js";import{N as c,Na as d,S as m,X as n,a as u,b as l,t as h}from"./chunk-MEK6ZYR6.js";var g=class a{constructor(t,e){this._HttpClient=t;this.userAuthService=e;this.userAuthService.isUserLogin.subscribe(r=>{if(r){let o=localStorage.getItem("token")||"";if(o){let s=b(o);this.customerId=s.ID,this.loadWishlistFromBackend(),this.loadCartItems(this.customerId)}}else this.customerId="",this.clearWishlist()})}apiUrl="https://aston.runasp.net/api/";wishlistState=d([]);customerId="";cartItems=d([]);getHeaders(){let t=localStorage.getItem("token")||"";return new i({Authorization:`Bearer ${t}`})}showAllProduct(){return this._HttpClient.get(`${this.apiUrl}Product/ShowAllProducts`)}ShowHighFeedbackProduct(){return this._HttpClient.get(`${this.apiUrl}Product/ShowHighFeedbackProduct?count=6`)}ShowRandomProduct(){return this._HttpClient.get(`${this.apiUrl}Product/ShowRandomProduct?count=8`)}showSpecifiProduct(t,e){return this._HttpClient.get(`https://aston.runasp.net/api/Product/ShowSpecificProduct?id=${t}&customerId=${e}`)}ShowProductByMerchantId(t){return this._HttpClient.get(`${this.apiUrl}Product/ShowProductByMerchantId?merchantId=${t}`)}ShowProductByCategory(t){return this._HttpClient.get(`${this.apiUrl}Product/ShowProductByCategory?categoryId=${t}&count=4`)}loadWishlistFromBackend(){this.customerId&&this.showAllFav(this.customerId).subscribe({next:t=>{let e=t.map(r=>({productId:r.productId,favId:r.id}));this.setWishlist(e)},error:t=>{console.error("Error fetching wishlist:",t),this.clearWishlist()}})}getWishlist(){return this.wishlistState.asReadonly()}setWishlist(t){this.wishlistState.set(t)}addToWishlist(t){this.wishlistState.set([...this.wishlistState(),t])}removeFromWishlist(t){this.wishlistState.set(this.wishlistState().filter(e=>e.productId!==t))}clearWishlist(){this.wishlistState.set([])}AddToFav(t,e){return this._HttpClient.post(`${this.apiUrl}Product/AddToFavProduct?cusId=${t}&ProdID=${e}`,null,{headers:this.getHeaders()})}DeleteFromFav(t){return this._HttpClient.delete(`${this.apiUrl}Product/DeleteProductFromFav?favId=${t}`,{headers:this.getHeaders()})}showAllFav(t){return this._HttpClient.get(`${this.apiUrl}Product/ShowAllFavProduct?customerId=${t}`,{headers:this.getHeaders()})}sentiment(t){return this._HttpClient.post("https://sentimentanalisis-api.onrender.com/predict",t)}addComment(t){return this._HttpClient.post(`${this.apiUrl}Product/AddComment`,t,{headers:this.getHeaders()})}deleteComment(t,e,r){return this._HttpClient.delete(`${this.apiUrl}Product/DeleteComment?customerId=${t}&productId=${e}&origincomment=${r}`)}checkBuying(t,e){return this._HttpClient.get(`${this.apiUrl}Product/CheckBuyingProduct?customerId=${t}&productId=${e}`)}processComment(t){let e=`pendingComment_${t.productId}_${t.customerId}`;return localStorage.setItem(e,JSON.stringify(t)),this.sentiment({text:t.originalComment}).pipe(c(r=>{let o=l(u({},t),{translateComment:r.translated_text,commentRate:Math.round(r.rating)});return this.addComment(o).pipe(h(s=>(localStorage.removeItem(e),s)))}))}retryPendingComments(){Object.keys(localStorage).filter(t=>t.startsWith("pendingComment_")).forEach(t=>{let e=JSON.parse(localStorage.getItem(t));this.processComment(e).subscribe({next:()=>{},error:r=>{console.error(`Failed to send pending comment for product ${e.productId}`,r)}})})}showsizeImageforColor(t,e){return this._HttpClient.get(`${this.apiUrl}Product/showsizeImageforColor?productId=${t}&colorId=${e}`,{headers:this.getHeaders()})}addToCart(t){return this._HttpClient.post(`${this.apiUrl}Product/AddToCart`,t,{headers:this.getHeaders()})}ShowAllCarts(t){return this._HttpClient.get(`${this.apiUrl}Product/ShowAllCarts?customerId=${t}`,{headers:this.getHeaders()})}deleteCart(t){return this._HttpClient.delete(`${this.apiUrl}Product/DeleteFromCart?cartId=${t}`)}updateQuantity(t,e){return this._HttpClient.put(`${this.apiUrl}Product/UpdateQuantity?cartId=${t}&quantity=${e}`,{headers:this.getHeaders()})}addToCartItems(t){this.cartItems.update(e=>[...e,t])}removeFromCartItem(t,e,r){this.cartItems.update(o=>o.filter(s=>s.productId!==t||s.colorId!==e||s.sizeId!==r))}getCartItems(){return this.cartItems.asReadonly()}loadCartItems(t){this.ShowAllCarts(t).subscribe({next:e=>{let r=e.productIds.map((o,s)=>({productId:o,cartId:e.id[s]}));this.cartItems.set(r)},error:e=>{console.error("Error loading cart items:",e),this.cartItems.set([])}})}addOrder(t){return this._HttpClient.post(`${this.apiUrl}Order/AddOrder`,t,{headers:this.getHeaders()})}showCustomerOrders(t){return this._HttpClient.get(`${this.apiUrl}Customer/ShowCustomerOrders?customerId=${t}`)}getCustomerOrderDetails(t){return this._HttpClient.get(`${this.apiUrl}Customer/GetCustomerOrderDetails?orderId=${t}`)}TrainModel(){return this._HttpClient.get("https://aston.runasp.net/api/Product/TrainModel")}RecommendationTrain(t){return this._HttpClient.post("https://rerecom-api.onrender.com/train",t)}RecommendProduct(t,e){return this._HttpClient.post("https://rerecom-api.onrender.com/recommend-product",{product_id:t,top_n:e})}RecommendUser(t,e){return this._HttpClient.post("https://rerecom-api.onrender.com/recommend-user",{user_id:t,top_n:e})}ShowCustomerLogs(){return this._HttpClient.get("https://aston.runasp.net/api/Customer/ShowCustomerLogs")}postUserLogs(t){return this._HttpClient.post("https://rerecom-api.onrender.com/update-user-logs",t)}apiKey="fa-BVRzXM4pKmY8-9Xmd1o7lHeNqPbXS1YIsceno";tryIt(t){let e="https://api.fashn.ai/v1/run",r=new i({"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`});return this._HttpClient.post(e,t,{headers:r})}getPredictionStatus(t){let e=`https://api.fashn.ai/v1/status/${t}`,r=new i({Authorization:`Bearer ${this.apiKey}`});return this._HttpClient.get(e,{headers:r})}static \u0275fac=function(e){return new(e||a)(n(p),n(C))};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};export{g as a};
