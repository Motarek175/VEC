import{a as G}from"./chunk-JYENWLXZ.js";import{a as q}from"./chunk-I2CVAPWO.js";import{w as B}from"./chunk-BA4ST442.js";import{k as N,l as z,p as ee,q as O,r as Y}from"./chunk-VGTTCDMY.js";import{$a as W,Bb as $,Db as v,Ea as o,Eb as E,Fa as b,Na as h,Sa as _,Ua as l,_ as U,_a as P,ab as r,bb as n,cb as g,dc as D,e as Z,fc as M,ga as u,gb as C,ha as x,hb as f,ib as p,mc as j,tb as a,ub as V,vb as c,za as w}from"./chunk-MEK6ZYR6.js";var y=Z(ee());var J=(t,i)=>i.id,T=t=>["/product",t],A=(t,i)=>({"text-green-600":t,"text-yellow-600":i}),L=t=>({"line-through text-gray-400":t});function te(t,i){t&1&&(r(0,"div",18)(1,"p",19),a(2," Loading your wishlist... "),n()())}function ie(t,i){if(t&1){let e=C();r(0,"div",20)(1,"p",21),a(2),n(),r(3,"button",22),f("click",function(){u(e);let m=p();return x(m.loadWishlist())}),a(4," Retry "),n()()}if(t&2){let e=p();o(2),V(e.errorMessage())}}function ne(t,i){if(t&1&&(r(0,"span",49),a(1),n()),t&2){let e=p().$implicit;o(),c(" $",e.sellPrice.toFixed(2)," ")}}function re(t,i){if(t&1&&(r(0,"span",50),a(1),n()),t&2){let e=p().$implicit;o(),c(" $",e.sellPrice.toFixed(2)," ")}}function oe(t,i){if(t&1){let e=C();r(0,"div",26)(1,"div",27)(2,"div",28)(3,"a",29)(4,"img",30),f("error",function(m){u(e);let d=p(2);return x(d.onImageError(m))}),n()()(),r(5,"div",31)(6,"h5",32),a(7),n(),r(8,"p",33),a(9),n(),r(10,"div")(11,"span",34),a(12),n(),_(13,ne,2,1,"span",35),n()(),r(14,"div",28)(15,"button",36),f("click",function(){let m=u(e).$implicit,d=p(2);return x(d.removeFromWishlist(m.productId))}),g(16,"i",37),n()()(),r(17,"div",38)(18,"div",39)(19,"a",40)(20,"img",41),f("error",function(m){u(e);let d=p(2);return x(d.onImageError(m))}),n()()(),r(21,"div",42)(22,"h5",43),a(23),n()(),r(24,"div",42)(25,"p",44),a(26),n()(),r(27,"div",42)(28,"span",45),a(29),n(),_(30,re,2,1,"span",46),n(),r(31,"div",39)(32,"button",47),f("click",function(){let m=u(e).$implicit,d=p(2);return x(d.removeFromWishlist(m.productId))}),g(33,"i",48),n()()()()}if(t&2){let e=i.$implicit;o(3),l("routerLink",v(18,T,e.productId)),o(),l("src",e.image.startsWith("//")?"https:"+e.image:e.image||"https://fakeimg.pl/300/",w)("alt",e.title),o(3),c(" ",e.title," "),o(),l("ngClass",E(20,A,e.status==="Active",e.status==="Pending")),o(),c(" ",e.status==="Active"?"Available":"Under Review"," "),o(2),l("ngClass",v(23,L,e.discount>0)),o(),c(" $",e.unitPrice.toFixed(2)," "),o(),l("ngIf",e.discount>0),o(6),l("routerLink",v(25,T,e.productId)),o(),l("src",e.image.startsWith("//")?"https:"+e.image:e.image||"https://fakeimg.pl/300/",w)("alt",e.title),o(3),c(" ",e.title," "),o(2),l("ngClass",E(27,A,e.status==="Active",e.status==="Pending")),o(),c(" ",e.status==="Active"?"Available":"Under Review"," "),o(2),l("ngClass",v(30,L,e.discount>0)),o(),c(" $",e.unitPrice.toFixed(2)," "),o(),l("ngIf",e.discount>0)}}function se(t,i){if(t&1&&(r(0,"div",23)(1,"div",24)(2,"span",25),a(3,"Image"),n(),r(4,"span",25),a(5,"Name"),n(),r(6,"span",25),a(7,"Status"),n(),r(8,"span",25),a(9,"Price"),n(),r(10,"span",25),a(11,"Action"),n()(),P(12,oe,34,32,"div",26,J),n()),t&2){let e=p();o(12),W(e.wishlistItems())}}function ae(t,i){t&1&&(r(0,"div",51),g(1,"i",52),r(2,"p",19),a(3," Your wishlist is empty! "),n(),r(4,"p",53),a(5," Add some products to get started. "),n(),r(6,"button",54),a(7," Explore Products "),n()()),t&2&&(o(6),l("routerLink","/shop"))}function le(t,i){t&1&&(r(0,"div",18)(1,"p",19),a(2," Loading recommendations... "),n()())}function me(t,i){t&1&&(r(0,"div",51),g(1,"i",55),r(2,"p",19),a(3," No recommendations available "),n(),r(4,"p",53),a(5," Explore more products to get personalized recommendations. "),n(),r(6,"button",54),a(7," Explore Products "),n()()),t&2&&(o(6),l("routerLink","/shop"))}function de(t,i){if(t&1&&(r(0,"span",63),a(1),n()),t&2){let e=p().$implicit;o(),c(" $",e.sellPrice.toFixed(2)," ")}}function ce(t,i){if(t&1){let e=C();r(0,"div",26)(1,"a",29)(2,"img",57),f("error",function(m){u(e);let d=p(2);return x(d.onImageError(m))}),n()(),r(3,"div",58)(4,"h5",59),a(5),n(),r(6,"p",60),a(7),n(),r(8,"div")(9,"span",61),a(10),n(),_(11,de,2,1,"span",62),n()()()}if(t&2){let e=i.$implicit;o(),l("routerLink",v(9,T,e.id)),o(),l("src",e.imageUrls[0]&&e.imageUrls[0].startsWith("//")?"https:"+e.imageUrls[0]:e.imageUrls[0]||"https://fakeimg.deblan.org/600x400/000/fff",w)("alt",e.title),o(3),c(" ",e.title," "),o(),l("ngClass",E(11,A,e.status==="Active",e.status==="Pending")),o(),c(" ",e.status==="Active"?"Available":"Under Review"," "),o(2),l("ngClass",v(14,L,e.discount>0)),o(),c(" $",e.unitPrice.toFixed(2)," "),o(),l("ngIf",e.discount>0)}}function pe(t,i){if(t&1&&(r(0,"div",56),P(1,ce,12,16,"div",26,J),n()),t&2){let e=p();o(),W(e.recommendedProducts())}}var H=class t{constructor(i,e,s,m){this.customerService=i;this.userAuthService=e;this.trackingService=s;this.router=m}wishlistItems=h([]);recommendedProducts=h([]);loading=h(!0);recommendationsLoading=h(!1);errorMessage=h("");loginSubscription=null;customerId="";decodedToken;ngOnInit(){this.userAuthService.isUserLogin.value||y.default.fire({icon:"warning",title:"Please login first",text:"You need to be logged in to view your wishlist.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(i=>{if(i.isConfirmed){let e=this.router.url;localStorage.setItem("returnUrl",e),this.router.navigate(["/login"])}else this.router.navigate(["/"])}),this.loadWishlist()}getCustomerId(){let i=localStorage.getItem("token")||"";return i?O(i).ID:""}loadWishlist(){this.loading.set(!0);let i=this.getCustomerId();if(!i){this.errorMessage.set("Unable to fetch customer ID."),this.loading.set(!1);return}this.customerService.showAllFav(i).subscribe({next:e=>{this.wishlistItems.set(e),this.loading.set(!1),this.loadRecommendations()},error:e=>{e.status===404&&(this.wishlistItems.set([]),this.errorMessage.set("")),this.loading.set(!1)}})}loadRecommendations(){let i=this.wishlistItems();if(i.length===0){this.recommendedProducts.set([]);return}this.recommendationsLoading.set(!0);let e=i.slice(0,4),s=e.length,m;s===1?m=4:s===2?m=2:m=1;let d=[],I=0;e.forEach((R,ue)=>{this.customerService.RecommendProduct(R.productId,m).subscribe({next:k=>{let K=k.recommendations.map(([S,F])=>({productId:S,score:F}));d.push(...K),I++,I===s&&(s===3?this.customerService.RecommendProduct(e[0].productId,1).subscribe({next:S=>{let F=S.recommendations.map(([Q,X])=>({productId:Q,score:X}));d.push(...F),this.fetchProductDetails(d)},error:S=>{this.fetchProductDetails(d)}}):this.fetchProductDetails(d))},error:k=>{console.error("Error fetching recommendations for product:",R.productId,k),I++,I===s&&this.fetchProductDetails(d)}})})}fetchProductDetails(i){let e=[],s=0;if(i.length===0){this.recommendedProducts.set([]),this.recommendationsLoading.set(!1);return}i.slice(0,4).forEach(m=>{this.customerService.showSpecifiProduct(m.productId,this.getCustomerId()).subscribe({next:d=>{d&&e.push(d),s++,s===i.slice(0,4).length&&(this.recommendedProducts.set(e),this.recommendationsLoading.set(!1))},error:d=>{console.error("Error fetching product details for ID:",m.productId,d),s++,s===i.slice(0,4).length&&(this.recommendedProducts.set(e),this.recommendationsLoading.set(!1))}})})}removeFromWishlist(i){let e=this.wishlistItems().find(s=>s.productId===i)?.id;if(!e){y.default.fire({icon:"error",title:"Error",text:"Product not found in wishlist."});return}this.customerService.DeleteFromFav(e).subscribe({next:()=>{this.wishlistItems.update(s=>s.filter(m=>m.productId!==i)),this.trackingService.trackEvent(this.getCustomerId(),i,"remove_from_wishlist"),this.customerService.removeFromWishlist(i),y.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})},error:s=>{y.default.fire({icon:"error",title:"Error",text:"Failed to remove product from wishlist."}),console.error("Error removing from wishlist:",s)}})}onImageError(i){let e=i.target;e.src=e.src.startsWith("//")?`https:${e.src}`:"https://fakeimg.pl/300/"}static \u0275fac=function(e){return new(e||t)(b(q),b(Y),b(G),b(N))};static \u0275cmp=U({type:t,selectors:[["app-wishlist"]],standalone:!0,features:[$],decls:26,vars:8,consts:[[1,"mx-auto","px-2","md:py-2","lg:px-8","lg:py-0","my-10"],[1,"wishlist","container","mx-auto","px-4","py-8"],[1,"flex","flex-col","sm:flex-row","justify-between","items-center","mb-6","gap-4"],[1,"text-2xl","sm:text-3xl","font-bold","text-gray-800","text-center","sm:text-left"],[1,"text-gray-500","font-medium","text-base","sm:text-lg"],[1,"flex","gap-3","sm:gap-4"],["disabled","","title","This feature is not available yet",1,"px-3","py-1.5","sm:px-4","sm:py-2","bg-red-100","text-red-600","rounded-md","cursor-not-allowed","opacity-50","text-sm","sm:text-base","flex","items-center","gap-2"],[1,"fas","fa-heart-broken"],["disabled","","title","This feature is not available yet",1,"px-3","py-1.5","sm:px-4","sm:py-2","bg-[var(--main-color)]","text-white","rounded-md","cursor-not-allowed","opacity-50","text-sm","sm:text-base","flex","items-center","gap-2"],[1,"fas","fa-cart-plus"],["class","text-center py-10 animate-pulse",4,"ngIf"],["class","text-center py-8 sm:py-10 bg-red-100 text-red-800 p-4 rounded-lg",4,"ngIf"],["class","flex flex-col gap-4",4,"ngIf"],["class","text-center py-12 sm:py-20",4,"ngIf"],[1,"related-products","container","mx-auto","py-8"],[1,"text-2xl","sm:text-3xl","font-bold","text-gray-800","text-center","sm:text-left","mb-6"],[1,"text-sm","italic"],["class","grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",4,"ngIf"],[1,"text-center","py-10","animate-pulse"],[1,"text-lg","sm:text-xl","font-semibold","text-gray-600"],[1,"text-center","py-8","sm:py-10","bg-red-100","text-red-800","p-4","rounded-lg"],[1,"text-base","sm:text-lg","font-medium"],[1,"mt-3","sm:mt-4","px-3","sm:px-4","py-1.5","sm:py-2","bg-[var(--main-color)]","text-white","rounded-md","cursor-pointer","text-sm","sm:text-base",3,"click"],[1,"flex","flex-col","gap-4"],[1,"hidden","sm:grid","sm:grid-cols-5","gap-2","sm:gap-4","mb-1","shadow-xl","p-3","rounded-t-lg"],[1,"text-xl","font-semibold","text-gray-700","text-center"],[1,"bg-white","rounded-lg","sm:rounded-xl","shadow-xl","p-3","sm:p-4","border","border-gray-200"],[1,"flex","items-center","gap-3","sm:hidden"],[1,"flex-shrink-0"],[3,"routerLink"],[1,"w-20","h-20","object-fill","rounded-lg",3,"error","src","alt"],[1,"flex-1","flex","flex-col","gap-1"],[1,"text-base","font-semibold","text-gray-800","line-clamp-1"],[1,"text-sm","font-medium",3,"ngClass"],[1,"text-base","font-bold","text-gray-900",3,"ngClass"],["class","text-base font-bold text-green-600 ml-2",4,"ngIf"],[1,"px-2","py-1","bg-red-100","text-red-600","rounded-md","cursor-pointer",3,"click"],[1,"fas","fa-heart-broken","text-sm"],[1,"hidden","sm:grid","sm:grid-cols-5","gap-2","sm:gap-4","items-center"],[1,"flex","justify-center"],[1,"flex-shrink-0",3,"routerLink"],[1,"w-32","h-32","object-fill","rounded-lg","mx-auto",3,"error","src","alt"],[1,"text-center"],[1,"text-xl","font-semibold","text-gray-800","line-clamp-1"],[1,"text-xl","font-medium",3,"ngClass"],[1,"text-xl","font-bold","text-gray-900",3,"ngClass"],["class","text-xl font-bold text-green-600 ml-2",4,"ngIf"],[1,"px-3","py-2","bg-red-100","text-red-600","rounded-md","cursor-pointer",3,"click"],[1,"fas","fa-heart-broken","text-xl"],[1,"text-base","font-bold","text-green-600","ml-2"],[1,"text-xl","font-bold","text-green-600","ml-2"],[1,"text-center","py-12","sm:py-20"],[1,"fas","fa-heart-broken","text-4xl","sm:text-5xl","text-gray-400","mb-4"],[1,"text-gray-500","mt-2","text-sm","sm:text-base"],[1,"mt-3","sm:mt-4","px-4","sm:px-6","py-1.5","sm:py-2","bg-[var(--main-color)]","text-white","rounded-md","cursor-pointer","text-sm","sm:text-base",3,"routerLink"],[1,"fas","fa-box-open","text-4xl","sm:text-5xl","text-gray-400","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-4","sm:gap-6"],[1,"w-full","h-40","sm:h-48","object-contain","rounded-lg","mb-3",3,"error","src","alt"],[1,"flex","flex-col","gap-2"],[1,"text-base","sm:text-lg","font-semibold","text-gray-800","line-clamp-2"],[1,"text-sm","sm:text-base","font-medium",3,"ngClass"],[1,"text-base","sm:text-lg","font-bold","text-gray-900",3,"ngClass"],["class","text-base sm:text-lg font-bold text-green-600 ml-2",4,"ngIf"],[1,"text-base","sm:text-lg","font-bold","text-green-600","ml-2"]],template:function(e,s){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),a(4," My Wishlist "),r(5,"span",4),a(6),n()(),r(7,"div",5)(8,"button",6),g(9,"i",7),a(10," Remove All "),n(),r(11,"button",8),g(12,"i",9),a(13," Add All to Cart "),n()()(),_(14,te,3,0,"div",10)(15,ie,5,1,"div",11)(16,se,14,0,"div",12)(17,ae,8,1,"div",13),r(18,"div",14)(19,"h2",15),a(20," You May Also Like "),r(21,"span",16),a(22,"(Recommendation)"),n()(),_(23,le,3,0,"div",10)(24,me,8,1,"div",13)(25,pe,3,0,"div",17),n()()()),e&2&&(o(6),c(" (",s.wishlistItems().length," items) "),o(8),l("ngIf",s.loading()),o(),l("ngIf",!s.loading()&&s.errorMessage()),o(),l("ngIf",!s.loading()&&!s.errorMessage()&&s.wishlistItems().length>0),o(),l("ngIf",!s.loading()&&!s.errorMessage()&&s.wishlistItems().length===0),o(6),l("ngIf",s.recommendationsLoading()),o(),l("ngIf",!s.recommendationsLoading()&&s.recommendedProducts().length===0),o(),l("ngIf",!s.recommendationsLoading()&&s.recommendedProducts().length>0))},dependencies:[j,D,M,B,z]})};export{H as WishlistComponent};
