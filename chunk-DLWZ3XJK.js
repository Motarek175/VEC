import{a as oe}from"./chunk-JYENWLXZ.js";import{a as ne}from"./chunk-I2CVAPWO.js";import{a as Z,c as Y,h as q,j as K,k as X,n as $,o as ee,p as te,v as ie}from"./chunk-BA4ST442.js";import{k as G,l as J,p as ae,q as k,r as re}from"./chunk-VGTTCDMY.js";import{Bb as B,Db as N,Ea as l,Eb as M,Fa as b,Fb as j,Hb as T,Jb as V,Na as u,Sa as _,Ta as P,Ua as d,Vb as z,_ as O,a as E,ab as a,b as F,bb as o,cb as v,dc as U,e as le,ec as D,fc as R,ga as p,gb as f,ha as m,hb as h,ia as A,ib as c,ja as W,lc as Q,mc as H,tb as g,vb as C,xb as w,yb as y,za as L,zb as S}from"./chunk-MEK6ZYR6.js";var x=le(ae());var ce=n=>["/product",n],de=(n,t)=>({"bg-green-100 text-green-800":n,"bg-yellow-100 text-yellow-800":t}),pe=(n,t)=>({"line-through text-gray-400":n,"text-gray-600":t}),me=(n,t,e)=>({"opacity-50 cursor-not-allowed":n,"hover:text-red-600":t,"text-red-600":e}),ue=(n,t)=>({"bg-[var(--main-color)] text-white border-[var(--main-color)] rounded-full w-10 h-10 flex items-center justify-center":n,"":t});function ge(n,t){n&1&&(a(0,"div",2)(1,"div",3),A(),a(2,"svg",4),v(3,"circle",5)(4,"path",6),o(),W(),a(5,"span",7),g(6,"Loading..."),o()()())}function he(n,t){if(n&1){let e=f();a(0,"div",22)(1,"input",23),S("ngModelChange",function(i){p(e);let s=c(2);return y(s.searchQuery,i)||(s.searchQuery=i),m(i)}),h("ngModelChange",function(){p(e);let i=c(2);return m(i.applyFilters())}),o()()}if(n&2){let e=c(2);l(),w("ngModel",e.searchQuery)}}function _e(n,t){if(n&1){let e=f();a(0,"label",25)(1,"input",28),S("ngModelChange",function(i){p(e);let s=c(3);return y(s.selectedCategory,i)||(s.selectedCategory=i),m(i)}),h("ngModelChange",function(){p(e);let i=c(3);return m(i.applyFilters())}),o(),g(2),o()}if(n&2){let e=t.$implicit,r=c(3);l(),d("value",e),w("ngModel",r.selectedCategory),l(),C(" ",e," ")}}function fe(n,t){if(n&1){let e=f();a(0,"div",24)(1,"label",25)(2,"input",26),S("ngModelChange",function(i){p(e);let s=c(2);return y(s.selectedCategory,i)||(s.selectedCategory=i),m(i)}),h("ngModelChange",function(){p(e);let i=c(2);return m(i.applyFilters())}),o(),g(3," All Categories "),o(),_(4,_e,3,3,"label",27),o()}if(n&2){let e=c(2);l(2),w("ngModel",e.selectedCategory),l(2),d("ngForOf",e.categories())}}function ve(n,t){if(n&1){let e=f();a(0,"div",24)(1,"input",29),S("ngModelChange",function(i){p(e);let s=c(2);return y(s.minPrice,i)||(s.minPrice=i),m(i)}),h("ngModelChange",function(){p(e);let i=c(2);return m(i.applyFilters())}),o(),a(2,"input",30),S("ngModelChange",function(i){p(e);let s=c(2);return y(s.maxPrice,i)||(s.maxPrice=i),m(i)}),h("ngModelChange",function(){p(e);let i=c(2);return m(i.applyFilters())}),o()()}if(n&2){let e=c(2);l(),w("ngModel",e.minPrice),l(),w("ngModel",e.maxPrice)}}function xe(n,t){if(n&1){let e=f();a(0,"div",24)(1,"select",31),S("ngModelChange",function(i){p(e);let s=c(2);return y(s.sortOption,i)||(s.sortOption=i),m(i)}),h("ngModelChange",function(){p(e);let i=c(2);return m(i.applyFilters())}),a(2,"option",32),g(3,"Title (A-Z)"),o(),a(4,"option",33),g(5,"Title (Z-A)"),o(),a(6,"option",34),g(7,"Price (Low to High)"),o(),a(8,"option",35),g(9,"Price (High to Low)"),o()()()}if(n&2){let e=c(2);l(),w("ngModel",e.sortOption)}}function Ce(n,t){n&1&&(a(0,"div",36),v(1,"i",37),a(2,"p",38),g(3,"No products found"),o()())}function we(n,t){if(n&1&&(a(0,"span",53),g(1),T(2,"number"),o()),n&2){let e=c().$implicit;l(),C(" $",V(2,1,e.unitPrice*(1-e.discount/100),"1.2-2")," ")}}function ye(n,t){if(n&1){let e=f();a(0,"div",39)(1,"a",40)(2,"img",41),h("error",function(i){p(e);let s=c(2);return m(s.onImageError(i))}),o()(),a(3,"div",42)(4,"div",43)(5,"h5",44),g(6),o(),a(7,"span",45),g(8),o()(),a(9,"div",46)(10,"span",47),g(11,"Status:"),o(),a(12,"span",48),g(13),o()(),a(14,"div",7)(15,"span",49),g(16),T(17,"number"),o(),_(18,we,3,4,"span",50),o()(),a(19,"button",51),h("click",function(){let i=p(e).$implicit,s=c(2);return m(s.toggleWishlist(i.id))}),v(20,"i",52),o()()}if(n&2){let e=t.$implicit,r=c(2);d("routerLink",N(15,ce,e.id)),l(2),d("src",e.image,L)("alt",e.title),l(3),d("title",e.title),l(),C(" ",e.title," "),l(2),C(" ",e.categoryName," "),l(4),d("ngClass",M(17,de,e.status==="Active",e.status==="Pending")),l(),C(" ",e.status," "),l(2),d("ngClass",M(20,pe,e.discount>0,e.discount===0)),l(),C(" Price: $",V(17,12,e.unitPrice,"1.2-2")," "),l(2),d("ngIf",e.discount>0),l(),d("ngClass",j(23,me,!r.userAuthService.isUserLogin.value,r.userAuthService.isUserLogin.value&&!r.isInWishlist(e.id),r.isInWishlist(e.id)))}}function Se(n,t){if(n&1){let e=f();a(0,"button",61),h("click",function(){let i=p(e).$implicit,s=c(3);return m(s.changePage(i))}),g(1),o()}if(n&2){let e=t.$implicit,r=c(3);d("ngClass",M(2,ue,r.currentPage()===e,r.currentPage()!==e)),l(),C(" ",e," ")}}function be(n,t){if(n&1){let e=f();a(0,"div",54)(1,"nav",55)(2,"button",56),h("click",function(){p(e);let i=c(2);return m(i.changePage(i.currentPage()-1))}),v(3,"i",57),o(),_(4,Se,2,5,"button",58),a(5,"button",59),h("click",function(){p(e);let i=c(2);return m(i.changePage(i.currentPage()+1))}),v(6,"i",60),o()()()}if(n&2){let e=c(2);l(2),d("disabled",e.currentPage()===1),l(2),d("ngForOf",e.pageNumbers()),l(),d("disabled",e.currentPage()===e.totalPages())}}function Pe(n,t){if(n&1){let e=f();a(0,"div",8)(1,"aside",9)(2,"h2",10),g(3,"Filters"),o(),a(4,"div",11),_(5,he,2,1,"div",12),o(),a(6,"div",11)(7,"button",13),h("click",function(){p(e);let i=c();return m(i.toggleCategoryFilter())}),g(8," Category "),v(9,"i",14),o(),_(10,fe,5,2,"div",15),o(),a(11,"div",11)(12,"button",16),h("click",function(){p(e);let i=c();return m(i.togglePriceFilter())}),g(13," Price Range "),v(14,"i",14),o(),_(15,ve,3,2,"div",15),o(),a(16,"div")(17,"button",16),h("click",function(){p(e);let i=c();return m(i.toggleSortFilter())}),g(18," Sort By "),v(19,"i",14),o(),_(20,xe,10,1,"div",15),o()(),a(21,"div",17)(22,"div",18),_(23,Ce,4,0,"div",19)(24,ye,21,27,"div",20),o(),_(25,be,7,3,"div",21),o()()}if(n&2){let e=c();l(5),d("ngIf",e.isSearchOpen()),l(4),d("ngClass",e.getArrowClass(e.isCategoryOpen())),P("data-open",e.isCategoryOpen()),l(),d("ngIf",e.isCategoryOpen()),l(4),d("ngClass",e.getArrowClass(e.isPriceOpen())),P("data-open",e.isPriceOpen()),l(),d("ngIf",e.isPriceOpen()),l(4),d("ngClass",e.getArrowClass(e.isSortOpen())),P("data-open",e.isSortOpen()),l(),d("ngIf",e.isSortOpen()),l(3),d("ngIf",e.paginatedProducts().length===0),l(),d("ngForOf",e.paginatedProducts())("ngForTrackBy",e.trackByProductId),l(),d("ngIf",e.paginatedProducts().length!==0)}}var se=class n{constructor(t,e,r,i){this.customerService=t;this.userAuthService=e;this.TrackingService=r;this.router=i}customerPersonName="";customerId="";decodedToken;products=u([]);filteredProducts=u([]);paginatedProducts=u([]);categories=u([]);selectedCategory=u("");minPrice=u(null);maxPrice=u(null);searchQuery=u("");sortOption=u("title-asc");currentPage=u(1);pageSize=u(9);totalPages=u(1);loading=u(!1);errorMessage=u("");wishlist=u([]);loginSubscription=null;isCategoryOpen=u(!1);isPriceOpen=u(!1);isSearchOpen=u(!0);isSortOpen=u(!1);pageNumbers=z(()=>{let e;this.currentPage()<=this.totalPages()-3?e=this.currentPage():e=Math.max(1,this.totalPages()-3);let r=Math.min(this.totalPages(),e+4-1),i=[];for(let s=e;s<=r;s++)i.push(s);return i});ngOnInit(){let t=localStorage.getItem("token")||"";t?(this.decodedToken=k(t),this.customerPersonName=this.decodedToken.Name,this.customerId=this.decodedToken.ID):(this.customerId="",this.customerPersonName=""),this.loadProducts(),this.loginSubscription=this.userAuthService.isUserLogin.subscribe(e=>{e&&this.customerId&&this.customerService.loadCartItems(this.customerId)})}loadProducts(){this.loading.set(!0),this.customerService.showAllProduct().subscribe({next:t=>{this.products.set(t.map(e=>F(E({},e),{image:e.image.startsWith("//")?`https:${e.image}`:e.image}))),this.filteredProducts.set([...this.products()]),this.updateCategories(),this.applyFilters(),this.loading.set(!1)},error:t=>{this.errorMessage.set(t.error?.message||"Failed to load products"),this.loading.set(!1),this.products.set([]),this.filteredProducts.set([]),this.paginatedProducts.set([]),console.error("Error fetching products:",t)}})}toggleWishlist(t){if(!this.userAuthService.isUserLogin.getValue()){x.default.fire({icon:"warning",title:"Please login first",text:"You need to be logged in to add products to your wishlist.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(e=>{if(e.isConfirmed){let r=this.router.url;localStorage.setItem("returnUrl",r),this.router.navigate(["/login"])}});return}this.isInWishlist(t)?this.customerService.showAllFav(this.customerId).subscribe({next:e=>{let r=e.find(s=>s.productId===t);if(!r){this.wishlist.update(s=>s.filter(I=>I.productId!==t)),this.customerService.removeFromWishlist(t),x.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1});return}let i=r.id;this.customerService.DeleteFromFav(i).subscribe({next:()=>{this.wishlist.update(s=>s.filter(I=>I.productId!==t)),this.TrackingService.trackEvent(this.getCustomerId(),t,"remove_from_wishlist"),this.customerService.removeFromWishlist(t),x.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})},error:s=>{x.default.fire({icon:"error",title:"Error",text:"Failed to remove product from wishlist."}),console.error("Error removing from wishlist:",s)}})},error:e=>{e.status===404?(this.wishlist.update(r=>r.filter(i=>i.productId!==t)),this.TrackingService.trackEvent(this.customerId,t,"remove_from_wishlist"),this.customerService.removeFromWishlist(t),x.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})):(x.default.fire({icon:"error",title:"Error",text:"Failed to fetch wishlist for removal."}),console.error("Error fetching wishlist for removal:",e))}}):this.customerService.AddToFav(this.customerId,t).subscribe({next:e=>{let r=e?.id||Date.now();this.TrackingService.trackEvent(this.customerId,t,"add_to_wishlist"),this.customerService.addToWishlist({productId:t,favId:r}),x.default.fire({icon:"success",title:"Added",text:"Product added to wishlist!",timer:1500,showConfirmButton:!1})},error:e=>{x.default.fire({icon:"error",title:"Error",text:"Failed to add product to wishlist."}),console.error("Error adding to wishlist:",e)}})}addToCart(t){this.toggleWishlist(t)}isInWishlist(t){return this.customerService.getWishlist()().some(e=>e.productId===t)}normalizeCategory(t){let e=t.toLowerCase().replace(/-|\s+/g,"");return{shirt:"Shirts",tshirt:"Shirts",tshirts:"Shirts",jeans:"Jeans",denim:"Jeans",pants:"Pants"}[e]||t.charAt(0).toUpperCase()+t.slice(1)}updateCategories(){this.categories.set([...new Set(this.products().map(t=>this.normalizeCategory(t.categoryName)))])}applyFilters(){let t=[...this.products()];this.selectedCategory()&&(t=t.filter(e=>this.normalizeCategory(e.categoryName)===this.selectedCategory())),this.minPrice()!==null&&this.minPrice()>=0&&(t=t.filter(e=>e.sellPrice>=this.minPrice())),this.maxPrice()!==null&&this.maxPrice()>=0&&(t=t.filter(e=>e.sellPrice<=this.maxPrice())),this.searchQuery()&&(t=t.filter(e=>e.title.toLowerCase().includes(this.searchQuery().toLowerCase()))),t=this.sortProducts(t),this.filteredProducts.set(t),this.updatePagination()}sortProducts(t){switch(this.sortOption()){case"title-asc":return t.sort((e,r)=>e.title.localeCompare(r.title));case"title-desc":return t.sort((e,r)=>r.title.localeCompare(e.title));case"sellPrice-asc":return t.sort((e,r)=>e.sellPrice-r.sellPrice);case"sellPrice-desc":return t.sort((e,r)=>r.sellPrice-e.sellPrice);default:return t}}updatePagination(){this.totalPages.set(Math.ceil(this.filteredProducts().length/this.pageSize())),this.currentPage.set(Math.min(this.currentPage(),this.totalPages()||1));let t=(this.currentPage()-1)*this.pageSize();this.paginatedProducts.set(this.filteredProducts().slice(t,t+this.pageSize()))}changePage(t){t>=1&&t<=this.totalPages()&&(this.currentPage.set(t),this.updatePagination())}toggleCategoryFilter(){this.isCategoryOpen.set(!this.isCategoryOpen())}togglePriceFilter(){this.isPriceOpen.set(!this.isPriceOpen())}toggleSortFilter(){this.isSortOpen.set(!this.isSortOpen())}getArrowClass(t){return t?"fa-chevron-up":"fa-chevron-down"}trackByProductId(t,e){return e.id}onImageError(t){let e=t.target;e.src="https://fakeimg.pl/300/"}getCustomerId(){let t=localStorage.getItem("token")||"";return t?k(t).ID:""}static \u0275fac=function(e){return new(e||n)(b(ne),b(re),b(oe),b(G))};static \u0275cmp=O({type:n,selectors:[["app-shop"]],standalone:!0,features:[B],decls:2,vars:2,consts:[["class","fixed inset-0 flex items-center justify-center bg-white bg-opacity-75 z-50",4,"ngIf"],["class","container mx-auto p-6 flex flex-col lg:flex-row gap-6",4,"ngIf"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-white","bg-opacity-75","z-50"],[1,"flex","flex-col","items-center","gap-3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-10","w-10","text-[var(--main-color)]"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-lg","font-medium","text-gray-600"],[1,"container","mx-auto","p-6","flex","flex-col","lg:flex-row","gap-6"],[1,"w-full","lg:w-1/4","h-fit","bg-white","rounded-lg","shadow-lg","p-6"],[1,"text-2xl","font-bold","mb-6"],[1,"mb-6"],["class","mt-3",4,"ngIf"],[1,"w-full","flex","justify-between","items-center","text-lg","font-semibold","text-gray-700","hover:text-[var(--main-color)]","transition-colors","duration-300",3,"click"],[1,"fa-solid",3,"ngClass"],["class","mt-3 flex flex-col gap-2",4,"ngIf"],[1,"w-full","flex","justify-between","items-center","text-lg","font-semibold","text-gray-600","hover:text-[var(--main-color)]","transition-colors","duration-300",3,"click"],[1,"flex-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-3","gap-6"],["class","col-span-full text-center py-12 animate-pulse",4,"ngIf"],["class","relative cursor-pointer rounded-lg bg-white shadow-md hover:shadow-lg transition-shadow duration-300 transform hover:-translate-y-1",3,"routerLink",4,"ngFor","ngForOf","ngForTrackBy"],["class","flex justify-center mt-8",4,"ngIf"],[1,"mt-3"],["type","text","placeholder","Search products...",1,"w-full","p-2","border","rounded-lg","focus:outline-0","transition-all","duration-300","hover:border-[var(--main-color)]","focus:border-[var(--main-color)]",3,"ngModelChange","ngModel"],[1,"mt-3","flex","flex-col","gap-2"],[1,"flex","items-center","hover:bg-gray-100","p-1","rounded","transition-all","duration-200"],["type","radio","name","category","value","",1,"mr-2",3,"ngModelChange","ngModel"],["class","flex items-center hover:bg-gray-100 p-1 rounded transition-all duration-200",4,"ngFor","ngForOf"],["type","radio","name","category",1,"mr-2",3,"ngModelChange","value","ngModel"],["type","number","placeholder","Min Price",1,"w-full","p-2","border","rounded-lg","transition-all","duration-300","hover:border-[var(--main-color)]","focus:border-[var(--main-color)]",3,"ngModelChange","ngModel"],["type","number","placeholder","Max Price",1,"w-full","p-2","border","rounded-lg","transition-all","duration-300","hover:border-[var(--main-color)]","focus:border-[var(--main-color)]",3,"ngModelChange","ngModel"],[1,"w-full","p-2","border","rounded-lg","transition-all","duration-300","hover:border-[var(--main-color)]","focus:border-[var(--main-color)]",3,"ngModelChange","ngModel"],["value","title-asc"],["value","title-desc"],["value","sellPrice-asc"],["value","sellPrice-desc"],[1,"col-span-full","text-center","py-12","animate-pulse"],[1,"fa-solid","fa-magnifying-glass","text-4xl","text-gray-400","mb-4"],[1,"text-xl","font-semibold","text-gray-600"],[1,"relative","cursor-pointer","rounded-lg","bg-white","shadow-md","hover:shadow-lg","transition-shadow","duration-300","transform","hover:-translate-y-1",3,"routerLink"],[1,"block"],[1,"rounded-t-lg","w-full","h-72","object-fill",3,"error","src","alt"],[1,"p-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xl","font-semibold","text-gray-600",3,"title"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-2","mb-2"],[1,"font-semibold","text-xl","text-gray-600"],[1,"px-2","py-1","rounded","text-sm","font-medium",3,"ngClass"],[1,"mr-2",3,"ngClass"],["class","text-green-600 font-semibold ml-2",4,"ngIf"],[1,"absolute","outline-0","right-2","top-2","bg-white","px-2","py-1","border-2","border-transparent","rounded-full","cursor-pointer","transition-colors","duration-300",3,"click","ngClass"],[1,"text-xl","transition-all","duration-300","fa-solid","fa-heart"],[1,"text-green-600","font-semibold","ml-2"],[1,"flex","justify-center","mt-8"],[1,"inline-flex","rounded-lg","p-2"],[1,"px-4","py-2","cursor-pointer","disabled:cursor-not-allowed","transition-colors","duration-200","hover:bg-white","rounded-l-lg",3,"click","disabled"],[1,"fa-solid","fa-chevron-left"],["class","px-4 py-2 cursor-pointer rounded",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"px-4","py-2","cursor-pointer","bg-transparent","disabled:cursor-not-allowed","transition-colors","duration-200","hover:bg-white","rounded-r-lg",3,"click","disabled"],[1,"fa-solid","fa-chevron-right"],[1,"px-4","py-2","cursor-pointer","rounded",3,"click","ngClass"]],template:function(e,r){e&1&&_(0,ge,7,0,"div",0)(1,Pe,26,14,"div",1),e&2&&(d("ngIf",r.loading()),l(),d("ngIf",!r.loading()))},dependencies:[H,U,D,R,Q,ie,ee,te,Z,K,$,X,Y,q,J]})};export{se as ShopComponent};
