import{a as _e}from"./chunk-JYENWLXZ.js";import{a as ve}from"./chunk-I2CVAPWO.js";import{a as ce,c as de,d as me,f as ue,h as pe,i as ge,s as he,v as fe}from"./chunk-BA4ST442.js";import{i as se,k as ae,l as le,p as Se,q as L,r as xe}from"./chunk-VGTTCDMY.js";import{$a as y,Bb as X,C as O,Cb as k,Db as U,Ea as l,Eb as I,Fa as E,Fb as z,Gb as ee,Hb as $,Jb as A,Na as R,Sa as _,Ua as m,Va as G,Ya as D,Za as b,_ as W,_a as S,a as N,ab as n,b as M,bb as a,cb as x,dc as te,e as be,ec as ie,fc as re,ga as g,gb as w,ha as h,hb as v,ia as P,ib as d,ja as j,lb as Y,lc as oe,mc as ne,nb as q,q as B,sb as H,tb as u,vb as f,wb as J,xb as Z,yb as K,za as F,zb as Q}from"./chunk-MEK6ZYR6.js";var c=be(Se());var T=()=>[1,2,3,4,5],ye=o=>["/merchant-page",o],Ie=(o,i,e)=>({"bg-green-100 text-green-800":o,"bg-yellow-100 text-yellow-800":i,"bg-gray-300 text-gray-800":e}),Pe=(o,i)=>({"border-4 border-[var(--main-color)]":o,"border-2 border-gray-200":i}),V=(o,i)=>({"text-yellow-500":o,"text-gray-300":i}),ke=(o,i,e,t)=>({"text-yellow-500":o,"text-gray-300":i,"cursor-not-allowed":e,"cursor-pointer":t}),we=()=>[],Ee=(o,i)=>({"border-[var(--main-color)] ring-2 ring-[var(--main-color)] ring-offset-2 opacity-75 cursor-default":o,"border-gray-200 hover:ring-1 hover:ring-gray-400":i}),De=(o,i)=>({"border-[var(--main-color)] bg-[var(--main-color)] text-white":o,"border-gray-200 text-gray-600":i}),Te=o=>["/product",o],Fe=(o,i)=>({"bg-green-100 text-green-800":o,"bg-yellow-100 text-yellow-800":i}),Ve=(o,i)=>({"line-through text-gray-400":o,"text-gray-600":i}),Be=(o,i,e)=>({"opacity-50 cursor-not-allowed":o,"hover:text-red-600":i,"text-red-600":e});function Re(o,i){o&1&&(n(0,"div",26),x(1,"i",27),n(2,"p",28),u(3,"Product not found"),a()())}function Ue(o,i){if(o&1){let e=w();n(0,"img",62),v("click",function(){let r=g(e).$implicit,s=d(2);return h(s.selectImage(r))})("error",function(){let r=g(e).$implicit,s=d(2);return h(s.onImageError(r))}),a()}if(o&2){let e=i.$implicit,t=i.$index,r=d(2);q("alt","",r.product.title||""," variant ",t+1,""),m("src",e,F)("ngClass",I(5,Pe,r.selectedImage===e,r.selectedImage!==e))}}function ze(o,i){if(o&1&&(P(),n(0,"svg",40),x(1,"path",63),a()),o&2){let e=i.$implicit,t=d(2);m("ngClass",I(1,V,e<=t.product.merchantFeedbak,e>t.product.merchantFeedbak))}}function $e(o,i){if(o&1){let e=w();P(),n(0,"svg",64),v("click",function(){let r=g(e).$implicit,s=d(2);return h(!(s.product.personStar||s.newCommentData)&&s.selectStarRating(r))})("mouseenter",function(){let r=g(e).$implicit,s=d(2);return h(!(s.product.personStar||s.newCommentData)&&s.hoverStarRating(r))})("mouseleave",function(){g(e);let r=d(2);return h(!(r.product.personStar||r.newCommentData)&&r.resetHoverStarRating())}),x(1,"path",63),a()}if(o&2){let e=i.$implicit,t=d(2);m("ngClass",ee(1,ke,e<=(t.hoverStarRatingValue||t.selectedStarRating||t.product.personStar||0),e>(t.hoverStarRatingValue||t.selectedStarRating||t.product.personStar||0),t.product.personStar||t.newCommentData,!(t.product.personStar||t.newCommentData)))}}function Ae(o,i){if(o&1&&(n(0,"span",65),u(1),a()),o&2){let e=d(2);l(),f(" $",(e.product.unitPrice||0).toFixed(2)," ")}}function Le(o,i){if(o&1&&(n(0,"span",66),u(1),a()),o&2){let e=d(2);l(),f(" ",e.product.discount,"% OFF ")}}function Ne(o,i){if(o&1){let e=w();n(0,"button",69),v("click",function(){let r=g(e),s=r.$implicit,p=r.$index,C=d(3);return h(C.selectColor(s,C.product.colorId[p]))}),a()}if(o&2){let e=i.$implicit,t=d(3);G("background",t.getGradientColor(e)),m("ngClass",I(4,Ee,t.selectedColor===e,t.selectedColor!==e))("title",e)}}function Me(o,i){if(o&1&&(n(0,"div",67),S(1,Ne,1,7,"button",68,b),a()),o&2){let e=d(2);l(),y(e.product.color||k(0,we))}}function Oe(o,i){if(o&1){let e=w();n(0,"button",73),v("click",function(){let r=g(e).$implicit,s=d(4);return h(s.selectSize(r))}),u(1),a()}if(o&2){let e=i.$implicit,t=d(4);m("ngClass",I(2,De,t.selectedSize===e,t.selectedSize!==e)),l(),f(" ",e," ")}}function We(o,i){if(o&1&&S(0,Oe,2,5,"button",72,b),o&2){let e=d(3);y(e.availableSizes)}}function je(o,i){o&1&&(n(0,"p",71),u(1," Please select a color to view available sizes. "),a())}function Ge(o,i){if(o&1&&(n(0,"div",70),_(1,We,2,0)(2,je,2,0,"p",71),a()),o&2){let e=d(2);l(),D(e.availableSizes.length>0?1:2)}}function Ye(o,i){if(o&1){let e=w();n(0,"button",74),v("click",function(){g(e);let r=d(2);return h(r.toggleWishlist())}),x(1,"i",75),a()}if(o&2){let e=d(2);m("disabled",e.product.status==="OutOfStock")}}function qe(o,i){if(o&1){let e=w();n(0,"button",76),v("click",function(){g(e);let r=d(2);return h(r.toggleWishlist())}),x(1,"i",75),a()}if(o&2){let e=d(2);m("disabled",e.product.status==="OutOfStock")}}function He(o,i){if(o&1){let e=w();n(0,"div",29)(1,"div",30)(2,"div",31)(3,"img",32),v("error",function(){g(e);let r=d();return h(r.onImageError(r.selectedImage))}),a()(),n(4,"div",33),S(5,Ue,1,8,"img",34,b),a()(),n(7,"div",35)(8,"h2",36),u(9),a(),n(10,"div",37)(11,"a",38),u(12),a(),n(13,"span",39),S(14,ze,2,4,":svg:svg",40,b),a()(),n(16,"div",41)(17,"div",42),S(18,$e,2,6,":svg:svg",43,b),a()(),n(20,"div",44)(21,"span",45),u(22),a(),_(23,Ae,2,1,"span",46)(24,Le,2,1,"span",47),a(),n(25,"p",48),u(26),a(),n(27,"div",37)(28,"span",49),u(29,"Status:"),a(),n(30,"span",50),u(31),a()(),n(32,"div",51)(33,"h3",52),u(34,"Color:"),a(),_(35,Me,3,1,"div",53),a(),n(36,"div",54)(37,"h3",52),u(38,"Size:"),a(),_(39,Ge,3,1,"div",55),a(),n(40,"div",56)(41,"button",57),v("click",function(){g(e);let r=d();return h(r.toggleCart())}),u(42," Add to Cart "),a(),n(43,"button",58),v("click",function(){g(e);let r=d();return h(r.tryIt())}),u(44," Try It "),a(),n(45,"div",59),_(46,Ye,2,1,"button",60)(47,qe,2,1,"button",61),a()()()()}if(o&2){let e=d();l(3),Y("alt",e.product.title||""),m("src",e.selectedImage||"https://fakeimg.pl/300/",F),l(2),y(e.prodImages),l(4),f(" ",e.product.title||""," "),l(2),m("routerLink",U(16,ye,e.product.merchantId)),l(),f("Merchant: ",e.product.merchantName," "),l(2),y(k(18,T)),l(4),y(k(19,T)),l(4),f(" $",(e.product.sellPrice||e.product.unitPrice||0).toFixed(2)," "),l(),m("ngIf",e.product.discount>0),l(),m("ngIf",e.product.discount>0),l(2),f(" ",e.product.description||"No description available."," "),l(4),m("ngClass",z(20,Ie,e.product.status==="Active",e.product.status==="Pending",e.product.status==="OutOfStock")),l(),f(" ",e.product.status||"Unknown"," "),l(4),m("ngIf",e.product.status!=="OutOfStock"),l(4),m("ngIf",e.product.status!=="OutOfStock"),l(2),m("disabled",e.product.status==="OutOfStock"),l(2),m("disabled",e.product.status==="OutOfStock"),l(3),D(e.isInWishlist(e.product.id)?46:47)}}function Je(o,i){if(o&1&&(P(),n(0,"svg",10),x(1,"path",63),a()),o&2){let e=i.$implicit,t=d();m("ngClass",I(1,V,e<=t.averageRating(),e>t.averageRating()))}}function Ze(o,i){if(o&1&&(P(),n(0,"svg",83),x(1,"path",63),a()),o&2){let e=i.$implicit,t=d().$index,r=d(2);m("ngClass",I(1,V,e<=r.product.allStars[t],e>r.product.allStars[t]))}}function Ke(o,i){if(o&1){let e=w();n(0,"button",87),v("click",function(){g(e);let r=d(),s=r.$implicit,p=r.$index,C=d(2);return h(C.deleteComment(C.product.id,s,p))}),x(1,"i",88),a()}}function Qe(o,i){if(o&1&&(n(0,"div",77)(1,"div",78),x(2,"img",79),a(),n(3,"div",80)(4,"h2",81),u(5),a(),n(6,"div",82),S(7,Ze,2,4,":svg:svg",83,b),a(),n(9,"p",84),u(10),n(11,"span",85),u(12),a()(),_(13,Ke,2,0,"button",86),a()()),o&2){let e=i.$implicit,t=i.$index,r=d(2);l(5),f(" ",r.product.userName[t]," "),l(2),y(k(5,T)),l(3),f(" ",e||"No comment provided"," "),l(2),J(" (Sentiment: ",r.sentiment[t],", CommentRate: ",r.product.commentRate[t],")"),l(),m("ngIf",r.customerPersonName===r.product.userName[t])}}function Xe(o,i){if(o&1&&(P(),n(0,"svg",89),x(1,"path",92),a()),o&2){let e=i.$implicit,t=d(3);m("ngClass",I(1,V,e<=t.newCommentData.star,e>t.newCommentData.star))}}function et(o,i){if(o&1){let e=w();n(0,"div",77)(1,"div",78),x(2,"img",79),a(),n(3,"div",80)(4,"h2",81),u(5),a(),n(6,"div",82),S(7,Xe,2,4,":svg:svg",89,b),a(),n(9,"p",84),u(10),a(),n(11,"button",90),v("click",function(){g(e);let r=d(2);return h(r.deleteNewComment())}),x(12,"i",91),a()()()}if(o&2){let e=d(2);l(5),f(" ",e.customerPersonName," "),l(2),y(k(2,T)),l(3),f(" ",e.newCommentData.originalComment||"No comment provided"," ")}}function tt(o,i){if(o&1&&(S(0,Qe,14,6,"div",77,b),_(2,et,13,3,"div",77)),o&2){let e=d();y(e.product.originalComment||k(1,we)),l(2),D(e.newCommentData?2:-1)}}function it(o,i){o&1&&(n(0,"p",14),u(1,"No reviews yet."),a())}function rt(o,i){o&1&&(n(0,"div",93)(1,"p",94),u(2," Processing your comment... "),a()())}function ot(o,i){o&1&&(n(0,"div",95),P(),n(1,"svg",96),x(2,"circle",97)(3,"path",98),a()())}function nt(o,i){o&1&&(n(0,"div",99),x(1,"i",100),n(2,"p",28),u(3,"No related products found"),a()())}function st(o,i){if(o&1&&(n(0,"span",118),u(1),$(2,"number"),a()),o&2){let e=d().$implicit;l(),f(" $",A(2,1,e.unitPrice*(1-e.discount/100),"1.2-2")," ")}}function at(o,i){if(o&1){let e=w();n(0,"div",103)(1,"a",104)(2,"img",105),v("error",function(){let r=g(e).$implicit,s=d(2);return h(s.onImageError(r.image))}),a()(),n(3,"div",106)(4,"div",107)(5,"h5",108),u(6),a(),n(7,"span",109),u(8),a()(),n(9,"div",110)(10,"span",111),u(11,"Status:"),a(),n(12,"span",112),u(13),a()(),n(14,"div",113)(15,"span",114),u(16),$(17,"number"),a(),_(18,st,3,4,"span",115),a()(),n(19,"button",116),v("click",function(r){let s=g(e).$implicit;return d(2).toggleWishlistRelated(s.id),h(r.stopPropagation())}),x(20,"i",117),a()()}if(o&2){let e=i.$implicit,t=d(2);m("routerLink",U(15,Te,e.id)),l(2),m("src",e.image,F)("alt",e.title),l(3),m("title",e.title),l(),f(" ",e.title," "),l(2),f(" ",e.categoryName," "),l(4),m("ngClass",I(17,Fe,e.status==="Active",e.status==="Pending")),l(),f(" ",e.status," "),l(2),m("ngClass",I(20,Ve,e.discount>0,e.discount===0)),l(),f(" Price: $",A(17,12,e.unitPrice,"1.2-2")," "),l(2),m("ngIf",e.discount>0),l(),m("ngClass",z(23,Be,!t.UserAuthService.isUserLogin.value,t.UserAuthService.isUserLogin.value&&!t.isInWishlist(e.id),t.isInWishlist(e.id)))}}function lt(o,i){if(o&1&&(n(0,"div",101),_(1,at,21,27,"div",102),a()),o&2){let e=d();l(),m("ngForOf",e.relatedProducts())("ngForTrackBy",e.trackByProductId)}}var Ce=class o{constructor(i,e,t,r,s){this.route=i;this.customerService=e;this.trackingService=t;this.UserAuthService=r;this.router=s}product=null;loading=!1;loadingRelatedProducts=!1;newComment="";selectedImage="";selectedColor=null;selectedColorId=null;selectedSize=null;prodImages=[];availableSizes=[];availableSizeIds=[];wishlist=R([]);relatedProducts=R([]);customerPersonName="";customerId="";decodedToken;userName=[];selectedStarRating=0;hoverStarRatingValue=0;newCommentData=null;isCommentProcessing=!1;loginSubscription=null;routeSubscription=null;sentiment=[];ngOnInit(){let i=localStorage.getItem("token")||"";i?(this.decodedToken=L(i),this.customerPersonName=this.decodedToken.Name,this.customerId=this.decodedToken.ID):(this.customerId="",this.customerPersonName=""),this.routeSubscription=this.route.paramMap.subscribe(e=>{let t=+e.get("prodId");t&&(this.loadProductDetails(t,this.customerId),this.loadPendingComment(t),this.trackingService.trackEvent(this.getCustomerId(),t,"view"))}),this.customerService.retryPendingComments(),this.loginSubscription=this.UserAuthService.isUserLogin.subscribe(e=>{e&&this.customerId&&this.customerService.loadCartItems(this.customerId)})}ngOnDestroy(){this.loginSubscription&&this.loginSubscription.unsubscribe()}loadPendingComment(i){let e=`pendingComment_${i}_${this.customerId}`,t=localStorage.getItem(e);t&&(this.newCommentData=JSON.parse(t))}savePendingComment(i){let e=`pendingComment_${i.productId}_${this.customerId}`;localStorage.setItem(e,JSON.stringify(i))}clearPendingComment(i){let e=`pendingComment_${i}_${this.customerId}`;localStorage.removeItem(e)}loadProductDetails(i,e){this.loading=!0,this.customerService.showSpecifiProduct(i,e).subscribe({next:t=>{this.userName=t.userName||[],this.product=t||null,this.prodImages=(t.imageUrls||[]).map(s=>s.startsWith("//")?`https:${s}`:s),this.availableSizes=[],this.availableSizeIds=[],this.selectedImage=this.prodImages[0]||"https://fakeimg.pl/300/",this.selectedStarRating=t.personStar?Math.round(t.personStar):0,this.loading=!1,t.color?.length&&t.colorId?.length&&this.selectColor(t.color[0],t.colorId[0]),this.sentiment=[];let r=t.commentRate||[];for(let s=0;s<r.length;s++){let p=r[s];p>=4?this.sentiment.push("happy"):p===3?this.sentiment.push("normal"):p===2?this.sentiment.push("sad"):this.sentiment.push("angry")}this.loadRelatedProduct(this.product.categoriesId)},error:t=>{console.error("Error fetching product details:",t),this.product=null,this.loading=!1}})}getGradientColor(i){if(!i.includes("&"))return i;let e=i.split("&").map(p=>p.trim()),r=100/e.length;return`linear-gradient(to right, ${e.map((p,C)=>`${p} ${C*r}%, ${p} ${(C+1)*r}%`).join(", ")})`}getMixedColor(i){if(!i.includes("&"))return i;let e=i.split("&").map(p=>p.trim());if(e.length===1)return e[0];let t=0,r=0,s=0;return e.forEach(p=>{let C=p.replace("#","");t+=parseInt(C.substr(0,2),16),r+=parseInt(C.substr(2,2),16),s+=parseInt(C.substr(4,2),16)}),t=Math.round(t/e.length),r=Math.round(r/e.length),s=Math.round(s/e.length),`#${t.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`}loadRelatedProduct(i){this.loadingRelatedProducts=!0,this.customerService.ShowProductByCategory(i).subscribe({next:e=>{let t=e.map(r=>({id:r.id,title:r.title,categoryName:r.category,status:r.status,unitPrice:r.unitPrice,discount:r.discount,sellPrice:r.sellPrice,image:r.imageUrl?.startsWith("//")?`https:${r.imageUrl}`:r.imageUrl||"https://fakeimg.pl/300/"})).slice(0,4);this.relatedProducts.set(t),this.loadingRelatedProducts=!1},error:e=>{console.error("Error fetching related products:",e),this.relatedProducts.set([]),this.loadingRelatedProducts=!1}})}selectImage(i){this.selectedImage=i}selectColor(i,e){this.selectedColor===i&&this.selectedColorId===e||(this.selectedColor=i,this.selectedColorId=e,this.loading=!0,this.customerService.showsizeImageforColor(this.product.id,e).subscribe({next:t=>{this.prodImages=(t.images||[]).map(r=>r.startsWith("//")?`https:${r}`:r),this.selectedImage=this.prodImages[0]||"https://fakeimg.pl/300/",this.availableSizes=t.sizes||[],this.availableSizeIds=t.sizeId||[],this.selectedSize&&!this.availableSizes.includes(this.selectedSize)&&(this.selectedSize=null),this.loading=!1},error:t=>{console.error("Error fetching images and sizes for color:",t),c.default.fire({icon:"error",title:"Error",text:"Failed to load images and sizes for the selected color."}),this.prodImages=(this.product?.imageUrls||[]).map(r=>r.startsWith("//")?`https:${r}`:r),this.availableSizes=[],this.availableSizeIds=[],this.selectedImage=this.prodImages[0]||"https://fakeimg.pl/300/",this.selectedSize=null,this.loading=!1}}))}selectSize(i){this.selectedSize=this.selectedSize===i?null:i}roundStar(i){return i?Math.round(i):0}hoverStarRating(i){this.hoverStarRatingValue=i}resetHoverStarRating(){this.hoverStarRatingValue=0}selectStarRating(i){if(!this.UserAuthService.isUserLogin.getValue()){c.default.fire({icon:"warning",title:"Please Log In First",text:"You must log in first to rate this product.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(t=>{if(t.isConfirmed){let r=this.router.url;localStorage.setItem("returnUrl",r),this.router.navigate(["/login"])}});return}let e=this.product?.id;e&&this.customerService.checkBuying(this.customerId,e).subscribe({next:t=>{if(!t.buyIt){c.default.fire({icon:"warning",title:"Cannot Rate",text:"You must purchase and receive the product before rating."}),this.selectedStarRating=0;return}this.selectedStarRating=i},error:t=>{c.default.fire({icon:"error",title:"Error",text:"Failed to verify purchase status."}),console.error("Error checking purchase:",t)}})}toggleWishlist(){if(this.UserAuthService.isUserLogin.getValue()){let i=+this.route.snapshot.paramMap.get("prodId");this.isInWishlist(i)?this.customerService.showAllFav(this.customerId).subscribe({next:e=>{let t=e.find(s=>s.productId===i);if(!t){this.wishlist.update(s=>s.filter(p=>p.productId!==i)),this.customerService.removeFromWishlist(i),c.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1});return}let r=t.id;this.customerService.DeleteFromFav(r).subscribe({next:()=>{this.wishlist.update(s=>s.filter(p=>p.productId!==i)),this.trackingService.trackEvent(this.getCustomerId(),i,"remove_from_wishlist"),this.customerService.removeFromWishlist(i),c.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})},error:s=>{c.default.fire({icon:"error",title:"Error",text:"Failed to remove product from wishlist."}),console.error("Error removing from wishlist:",s)}})},error:e=>{e.status===404?(this.wishlist.update(t=>t.filter(r=>r.productId!==i)),this.customerService.removeFromWishlist(i),c.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})):(c.default.fire({icon:"error",title:"Error",text:"Failed to fetch wishlist for removal."}),console.error("Error fetching wishlist for removal:",e))}}):this.customerService.AddToFav(this.customerId,i).subscribe({next:e=>{let t=e?.id||Date.now();this.customerService.addToWishlist({productId:i,favId:t}),this.wishlist.update(r=>[...r,{productId:i,favId:t}]),this.trackingService.trackEvent(this.getCustomerId(),i,"add_to_wishlist"),c.default.fire({icon:"success",title:"Added",text:"Product added to wishlist!",timer:1500,showConfirmButton:!1})},error:e=>{c.default.fire({icon:"error",title:"Error",text:"Failed to add product to wishlist."}),console.error("Error adding to wishlist:",e)}})}else c.default.fire({icon:"warning",title:"Please Log In First",text:"You must log in first to add products to your wishlist.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(i=>{if(i.isConfirmed){let e=this.router.url;localStorage.setItem("returnUrl",e),this.router.navigate(["/login"])}})}toggleWishlistRelated(i){if(!this.UserAuthService.isUserLogin.getValue()){c.default.fire({icon:"warning",title:"Please Log In First",text:"You must log in to add products to your wishlist.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(e=>{if(e.isConfirmed){let t=this.router.url;localStorage.setItem("returnUrl",t),this.router.navigate(["/login"])}});return}this.isInWishlist(i)?this.customerService.showAllFav(this.customerId).subscribe({next:e=>{let t=e.find(s=>s.productId===i);if(!t){this.wishlist.update(s=>s.filter(p=>p.productId!==i)),this.customerService.removeFromWishlist(i),c.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1});return}let r=t.id;this.customerService.DeleteFromFav(r).subscribe({next:()=>{this.wishlist.update(s=>s.filter(p=>p.productId!==i)),this.customerService.removeFromWishlist(i),c.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})},error:s=>{c.default.fire({icon:"error",title:"Error",text:"Failed to remove product from wishlist."}),console.error("Error removing from wishlist:",s)}})},error:e=>{e.status===404?(this.wishlist.update(t=>t.filter(r=>r.productId!==i)),this.trackingService.trackEvent(this.customerId,i,"remove_from_wishlist"),this.customerService.removeFromWishlist(i),c.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})):(c.default.fire({icon:"error",title:"Error",text:"Failed to fetch wishlist for removal."}),console.error("Error fetching wishlist for removal:",e))}}):this.customerService.AddToFav(this.customerId,i).subscribe({next:e=>{let t=e?.id||Date.now();this.trackingService.trackEvent(this.customerId,i,"add_to_wishlist"),this.customerService.addToWishlist({productId:i,favId:t}),this.wishlist.update(r=>[...r,{productId:i,favId:t}]),c.default.fire({icon:"success",title:"Added",text:"Product added to wishlist!",timer:1500,showConfirmButton:!1})},error:e=>{c.default.fire({icon:"error",title:"Error",text:"Failed to add product to wishlist."}),console.error("Error adding to wishlist:",e)}})}isInWishlist(i){return this.customerService.getWishlist()().some(e=>e.productId===i)}isInCart(i,e,t){return!e||!t?!1:this.customerService.getCartItems()().some(r=>r.productId===i&&r.colorId===e&&r.sizeId===t)}toggleCart(){if(!this.UserAuthService.isUserLogin.getValue()){c.default.fire({icon:"warning",title:"Please Log In First",text:"You must log in to manage your cart.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(s=>{if(s.isConfirmed){let p=this.router.url;localStorage.setItem("returnUrl",p),this.router.navigate(["/login"])}});return}let i=this.product?.id;if(!i){c.default.fire({icon:"error",title:"Error",text:"Product not found."});return}if(!this.selectedColorId){c.default.fire({icon:"warning",title:"Select Color",text:"Please select a color before adding to cart."});return}if(!this.selectedSize){c.default.fire({icon:"warning",title:"Select Size",text:"Please select a size before adding to cart."});return}let e=this.availableSizes.indexOf(this.selectedSize);if(e===-1){c.default.fire({icon:"error",title:"Error",text:"Invalid size selected."});return}let t=this.availableSizeIds[e],r={productId:i,colorId:this.selectedColorId,sizeId:t,customerId:this.customerId};this.loading=!0,this.customerService.addToCart(r).subscribe({next:s=>{let p=s?.id||Date.now();this.customerService.addToCartItems({productId:i,cartId:p,colorId:this.selectedColorId,sizeId:t}),this.loading=!1,this.trackingService.trackEvent(this.getCustomerId(),i,"add_to_cart"),c.default.fire({icon:"success",title:"Added",text:"Product added to cart successfully!",timer:1500,showConfirmButton:!1})},error:s=>{this.loading=!1,s.error?.message?.toLowerCase().includes("item exist before inside cart")?(this.customerService.loadCartItems(this.customerId),c.default.fire({icon:"info",title:"Already in Cart",text:"This product configuration is already in your cart, please remove it first from Cart ",showConfirmButton:!0})):(c.default.fire({icon:"error",title:"Error",text:s.error?.message||"Failed to add product to cart."}),console.error("Error adding to cart:",s))}})}tryIt(){if(!this.UserAuthService.isUserLogin.getValue()){c.default.fire({icon:"warning",title:"Please Log In First",text:"You must log in first to try the product.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(t=>{if(t.isConfirmed){let r=this.router.url;localStorage.setItem("returnUrl",r),this.router.navigate(["/login"])}});return}if(!this.product?.id){c.default.fire({icon:"error",title:"Error",text:"Product not found."});return}if(!this.selectedColor){c.default.fire({icon:"warning",title:"Select Color",text:"Please select a color before trying the product."});return}let e={type:this.product?.type||"",color:this.selectedColor,image:this.selectedImage||"https://fakeimg.pl/300/"};localStorage.setItem("tryItProduct",JSON.stringify(e)),this.router.navigate(["/try"])}submitComment(){if(!this.newComment.trim()){c.default.fire({icon:"warning",title:"Empty Comment",text:"Please enter a comment before submitting."});return}if(!this.selectedStarRating){c.default.fire({icon:"warning",title:"No Rating Selected",text:"Please select a star rating by clicking on the stars above."});return}if(!this.UserAuthService.isUserLogin.getValue()){c.default.fire({icon:"warning",title:"Please Log In First",text:"You must log in first to add a comment.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(e=>{if(e.isConfirmed){let t=this.router.url;localStorage.setItem("returnUrl",t),this.router.navigate(["/login"])}});return}let i=this.product?.id;i&&this.customerService.checkBuying(this.customerId,i).pipe(O(e=>e.status===404&&e.error&&"buyIt"in e.error?B(e.error):(c.default.fire({icon:"error",title:"Error",text:"Failed to connect to the server."}),console.error("Critical error checking purchase:",e),B(e)))).subscribe({next:e=>{if(!e.buyIt){c.default.fire({icon:"warning",title:"Cannot Comment",text:"You must purchase and receive the product before commenting."});return}c.default.fire({icon:"info",title:"Processing Comment",text:"Your comment is being analyzed and will be saved shortly.",showConfirmButton:!1,timer:2e3}),this.newCommentData={productId:i,customerId:this.customerId,star:this.selectedStarRating,originalComment:this.newComment,translateComment:this.newComment,commentRate:this.selectedStarRating},this.savePendingComment(this.newCommentData),this.isCommentProcessing=!0,this.customerService.processComment(this.newCommentData).subscribe({next:()=>{this.newCommentData=null,this.newComment="",this.selectedStarRating=this.product?.personStar?Math.round(this.product.personStar):0,this.isCommentProcessing=!1,this.loadProductDetails(i,this.customerId)},error:t=>{console.error("Error processing comment:",t),c.default.fire({icon:"error",title:"Error",text:t.error.error}).then(()=>{this.isCommentProcessing=!1,this.deleteNewComment()})}})},error:e=>{c.default.fire({icon:"error",title:"Error",text:"Failed to verify purchase status."}),console.error("Unexpected error:",e)}})}deleteComment(i,e,t){if(!this.UserAuthService.isUserLogin.getValue()){c.default.fire({icon:"warning",title:"Please Log In",text:"You must be logged in to delete a comment.",confirmButtonText:"Go to Login",showCancelButton:!0}).then(r=>{if(r.isConfirmed){let s=this.router.url;localStorage.setItem("returnUrl",s),this.router.navigate(["/login"])}});return}c.default.fire({icon:"warning",title:"Are you sure?",text:"Do you want to delete this comment?",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it"}).then(r=>{r.isConfirmed&&(this.loading=!0,this.customerService.deleteComment(this.customerId,i,e).subscribe({next:s=>{c.default.fire({icon:"success",title:"Deleted",text:"Comment deleted successfully!",timer:1500,showConfirmButton:!1}),this.loadProductDetails(i,this.customerId),this.loading=!1},error:s=>{c.default.fire({icon:"error",title:"Error",text:s.error.message||"Failed to delete comment."}),this.loading=!1,console.error("Error deleting comment:",s)}}))})}deleteNewComment(){if(!this.UserAuthService.isUserLogin.getValue()){c.default.fire({icon:"warning",title:"Please Log In",text:"You must be logged in to delete a comment.",confirmButtonText:"Go to Login",showCancelButton:!0}).then(e=>{if(e.isConfirmed){let t=this.router.url;localStorage.setItem("returnUrl",t),this.router.navigate(["/login"])}});return}let i=this.newCommentData?.productId;i&&(this.clearPendingComment(i),this.newCommentData=null,c.default.fire({icon:"success",title:"Deleted",text:"Comment deleted successfully!",timer:1500,showConfirmButton:!1}))}averageRating(){return this.product?.averageStar}onCommentChange(){}onImageError(i){console.warn("Image failed to load:",i),(!this.selectedImage||this.selectedImage===i)&&(this.selectedImage="https://fakeimg.pl/300/"),i&&(this.prodImages=this.prodImages.filter(e=>e!==i),this.relatedProducts.update(e=>e.map(t=>t.image===i?M(N({},t),{image:"https://fakeimg.pl/300/"}):t)))}trackByProductId(i,e){return e.id}getCustomerId(){let i=localStorage.getItem("token")||"";return i?L(i).ID:""}static \u0275fac=function(e){return new(e||o)(E(se),E(ve),E(_e),E(xe),E(ae))};static \u0275cmp=W({type:o,selectors:[["app-product-details"]],standalone:!0,features:[X],decls:32,vars:12,consts:[["commentForm","ngForm"],["commentInput",""],[1,"mx-auto","px-4","my-10","md:my-16","lg:px-12","lg:my-20","rounded-xl"],["class","text-center py-12",4,"ngIf"],["class","flex flex-col sm:flex-row gap-4 p-2 md:p-4",4,"ngIf"],[1,"mx-auto","px-4","my-10","md:my-16","lg:px-12","lg:my-20"],[1,"bg-white","rounded-2xl","shadow-2xl","p-6","border","border-gray-100"],[1,"mb-6","border-b-4","border-[var(--main-color)]","pb-4"],[1,"text-2xl","lg:text-4xl","font-extrabold","text-[var(--main-color)]","bg-gradient-to-r","from-[var(--main-color)]","to-gray-800","bg-clip-text","text-transparent"],[1,"flex","items-center","mt-4"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-7","h-7","mr-1","transition-colors","duration-300","transform","hover:scale-110",3,"ngClass"],[1,"ml-3","text-xl","font-semibold","text-gray-700"],[1,"text-[12px]","italic"],[1,"py-6"],[1,"text-center","text-gray-500","text-lg","py-6"],[1,"relative","mt-6",3,"ngSubmit"],["name","newComment","placeholder","Add Your Comment...","required","",1,"w-full","outline-none","text-sm","lg:text-base","text-gray-900","border","border-gray-300","rounded-xl","px-5","py-3","bg-white","focus:ring-4","focus:ring-[var(--main-color)]/50","transition-all","duration-300","shadow-sm",3,"ngModelChange","ngModel","disabled"],["type","submit",1,"absolute","cursor-pointer","right-2","top-1/2","-translate-y-1/2","bg-[var(--main-color)]","text-white","p-2","rounded-full","hover:bg-opacity-90","transition-all","duration-300","shadow-md","hover:shadow-lg","transform","hover:scale-110",3,"disabled"],["fill","currentColor","viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg",1,"w-5","h-5","rotate-90"],["d","M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"],["class","mt-2 text-center",4,"ngIf"],[1,"container","mx-auto","p-6"],[1,"text-2xl","font-bold","mb-6"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","text-center py-12 animate-pulse",4,"ngIf"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",4,"ngIf"],[1,"text-center","py-12"],[1,"fa-solid","fa-exclamation-triangle","text-4xl","text-red-500","mb-4"],[1,"text-xl","font-semibold","text-gray-600"],[1,"flex","flex-col","sm:flex-row","gap-4","p-2","md:p-4"],[1,"w-full","md:w-1/2","flex","flex-col","gap-2"],[1,"mainimg","w-full","relative","overflow-hidden","rounded-xl"],[1,"w-full","h-[400px]","object-contain","rounded-xl",3,"error","src","alt"],[1,"variants","w-full","flex","justify-center","sm:justify-start","flex-row","gap-2","overflow-x-auto"],[1,"w-[120px]","h-[120px]","object-cover","rounded-lg","cursor-pointer",3,"src","alt","ngClass"],[1,"w-full","md:w-1/2","p-2"],[1,"text-4xl","font-extrabold","text-gray-800"],[1,"mb-4","flex","items-center","gap-1"],["title","visit Merchant Product",1,"text-sm","font-black","italic","text-[var(--main-color)]","cursor-pointer","underline",3,"routerLink"],[1,"flex","items-center","mt-1"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-3","h-3","mr-1","transition-colors","duration-300","transform",3,"ngClass"],[1,"flex","items-center","mb-4"],[1,"flex","items-center"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-7","h-7","mr-1","star-rating",3,"ngClass"],[1,"mb-4"],[1,"text-3xl","font-bold","text-gray-800","mr-1"],["class","line-through text-gray-500 ml-1",4,"ngIf"],["class","text-green-600 ml-1",4,"ngIf"],[1,"text-gray-700","mb-4","text-lg","leading-tight"],[1,"font-semibold","text-xl","text-gray-700"],[1,"px-2","py-1","rounded-full","text-sm","font-medium",3,"ngClass"],[1,"mb-4","flex","gap-2","items-center"],[1,"text-xl","font-semibold","text-gray-800"],["class","flex gap-2",4,"ngIf"],[1,"mb-4","flex","items-center","gap-2"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","gap-2","mt-4"],[1,"flex-1","bg-[var(--main-color)]","cursor-pointer","px-4","py-2","text-white","rounded-lg","font-bold","text-lg","shadow-md","hover:shadow-lg","transform","hover:-translate-y-1","transition-all","duration-300","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","cursor-pointer","bg-gray-800","text-white","px-4","py-2","rounded-lg","font-bold","text-lg","shadow-md","hover:shadow-lg","transform","hover:-translate-y-1","transition-all","duration-300","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],[1,"flex","items-center","justify-center"],[1,"cursor-pointer","rounded-full","text-red-600","font-bold","text-lg","hover:text-red-800","transition-colors","duration-300","disabled:cursor-not-allowed","disabled:opacity-50","disabled:hover:text-gray-600",3,"disabled"],[1,"cursor-pointer","rounded-full","text-gray-600","font-bold","text-lg","hover:text-red-600","transition-colors","duration-300","disabled:cursor-not-allowed","disabled:opacity-50","disabled:hover:text-gray-600",3,"disabled"],[1,"w-[120px]","h-[120px]","object-cover","rounded-lg","cursor-pointer",3,"click","error","src","alt","ngClass"],["fill-rule","evenodd","d","M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.760-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z","clip-rule","evenodd"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-7","h-7","mr-1","star-rating",3,"click","mouseenter","mouseleave","ngClass"],[1,"line-through","text-gray-500","ml-1"],[1,"text-green-600","ml-1"],[1,"flex","gap-2"],[1,"w-8","h-8","rounded-full","border-2","focus:outline-none","transition-all","duration-300",3,"background","ngClass","title"],[1,"w-8","h-8","rounded-full","border-2","focus:outline-none","transition-all","duration-300",3,"click","ngClass","title"],[1,"flex","items-center","gap-2"],[1,"text-gray-500","text-sm"],[1,"border-2","cursor-pointer","px-3","py-1","rounded-full","text-sm","font-medium","transition-all","duration-300","hover:bg-[var(--main-color)]","hover:text-white",3,"ngClass"],[1,"border-2","cursor-pointer","px-3","py-1","rounded-full","text-sm","font-medium","transition-all","duration-300","hover:bg-[var(--main-color)]","hover:text-white",3,"click","ngClass"],[1,"cursor-pointer","rounded-full","text-red-600","font-bold","text-lg","hover:text-red-800","transition-colors","duration-300","disabled:cursor-not-allowed","disabled:opacity-50","disabled:hover:text-gray-600",3,"click","disabled"],[1,"fa-solid","fa-heart","text-2xl"],[1,"cursor-pointer","rounded-full","text-gray-600","font-bold","text-lg","hover:text-red-600","transition-colors","duration-300","disabled:cursor-not-allowed","disabled:opacity-50","disabled:hover:text-gray-600",3,"click","disabled"],[1,"flex","gap-6","mb-6","p-5","bg-gradient-to-br","from-white","to-gray-50","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-300","transform","hover:-translate-y-1"],[1,"img"],["src","https://static-00.iconduck.com/assets.00/person-icon-2048x1935-84jiekjd.png","alt","User",1,"w-16","h-16","rounded-full","object-cover","border-2","border-[var(--main-color)]","shadow-md"],[1,"review","flex-1","relative"],[1,"text-xl","lg:text-2xl","font-bold","text-gray-900"],[1,"flex","items-center","mb-2"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-3","h-3","mr-1","transition-colors","duration-300","cursor-pointer",3,"ngClass"],[1,"text-gray-700","text-base","lg:text-lg","leading-relaxed"],[1,"italic","text-sm","font-black"],["class","absolute right-0 top-1/2 cursor-pointer transform -translate-y-1/2 text-red-600 hover:text-red-800 transition-colors duration-300","title","Delete Comment",3,"click",4,"ngIf"],["title","Delete Comment",1,"absolute","right-0","top-1/2","cursor-pointer","transform","-translate-y-1/2","text-red-600","hover:text-red-800","transition-colors","duration-300",3,"click"],[1,"fa-solid","fa-trash","text-lg"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-3","h-3","mr-1","transition-all","duration-300",3,"ngClass"],["title","Delete Comment",1,"absolute","right-0","cursor-pointer","top-1/2","transform","-translate-y-1/2","text-red-600","hover:text-red-800","transition-colors","duration-300",3,"click"],[1,"fa-solid","fa-trash"],["fill-rule","evenodd","d","M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.760-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z","clip-rule","evenodd"],[1,"mt-2","text-center"],[1,"text-sm","lg:text-base","text-gray-600","animate-pulse"],[1,"flex","items-center","justify-center","py-12"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-10","w-10","text-[var(--main-color)]"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-center","py-12","animate-pulse"],[1,"fa-solid","fa-magnifying-glass","text-4xl","text-gray-400","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-4"],["class","relative cursor-pointer rounded-lg bg-white shadow-md hover:shadow-lg transition-shadow duration-300 transform hover:-translate-y-1",3,"routerLink",4,"ngFor","ngForOf","ngForTrackBy"],[1,"relative","cursor-pointer","rounded-lg","bg-white","shadow-md","hover:shadow-lg","transition-shadow","duration-300","transform","hover:-translate-y-1",3,"routerLink"],[1,"block"],[1,"rounded-t-lg","w-full","h-72","object-fill",3,"error","src","alt"],[1,"p-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xl","font-semibold","text-gray-600",3,"title"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-2","mb-2"],[1,"font-semibold","text-xl","text-gray-600"],[1,"px-2","py-1","rounded","text-sm","font-medium",3,"ngClass"],[1,"text-lg","font-medium","text-gray-600"],[1,"mr-2",3,"ngClass"],["class","text-green-600 font-semibold ml-2",4,"ngIf"],[1,"absolute","outline-0","right-2","top-2","bg-white","px-2","py-1","border-2","border-transparent","rounded-full","cursor-pointer","transition-colors","duration-300",3,"click","ngClass"],[1,"text-xl","transition-all","duration-300","fa-solid","fa-heart"],[1,"text-green-600","font-semibold","ml-2"]],template:function(e,t){if(e&1){let r=w();n(0,"div",2),_(1,Re,4,0,"div",3)(2,He,48,24,"div",4),a(),n(3,"section",5)(4,"div",6)(5,"div",7)(6,"h2",8),u(7," Customer Feedback "),a(),n(8,"div",9),S(9,Je,2,4,":svg:svg",10,b),n(11,"span",11),u(12),n(13,"span",12),u(14,"Average Reviews "),a()()()(),n(15,"div",13),_(16,tt,3,2)(17,it,2,0,"p",14),a(),n(18,"form",15,0),v("ngSubmit",function(){return g(r),h(t.submitComment())}),n(20,"input",16,1),Q("ngModelChange",function(p){return g(r),K(t.newComment,p)||(t.newComment=p),h(p)}),v("ngModelChange",function(){return g(r),h(t.onCommentChange())}),a(),n(22,"button",17),P(),n(23,"svg",18),x(24,"path",19),a()(),_(25,rt,3,0,"div",20),a()()(),j(),n(26,"div",21)(27,"h2",22),u(28,"Related Products"),a(),_(29,ot,4,0,"div",23)(30,nt,4,0,"div",24)(31,lt,2,2,"div",25),a()}if(e&2){let r=H(19);l(),m("ngIf",!t.product),l(),m("ngIf",t.product),l(7),y(k(11,T)),l(3),f("",(t.product==null||t.product.originalComment==null?null:t.product.originalComment.length)||0," "),l(4),D(t.product&&(t.product.originalComment||t.newCommentData)?16:17),l(4),Z("ngModel",t.newComment),m("disabled",!!(t.product!=null&&t.product.personStar)||!!t.newCommentData),l(2),m("disabled",!r.valid||!t.newComment.trim()||!!(t.product!=null&&t.product.personStar)||!!t.newCommentData),l(3),m("ngIf",t.loading),l(4),m("ngIf",t.loadingRelatedProducts),l(),m("ngIf",!t.loadingRelatedProducts&&t.relatedProducts().length===0),l(),m("ngIf",!t.loadingRelatedProducts&&t.relatedProducts().length>0)}},dependencies:[ne,te,ie,re,oe,fe,ge,ce,de,me,he,pe,ue,le]})};export{Ce as ProductDetailsComponent};
