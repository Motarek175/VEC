import{a as ne}from"./chunk-JYENWLXZ.js";import{a as re}from"./chunk-I2CVAPWO.js";import{a as G,c as J,h as Z,j as Y,k as q,n as K,o as X,p as $,v as ee}from"./chunk-BA4ST442.js";import{i as D,k as Q,l as H,p as le,q as te,r as ie}from"./chunk-VGTTCDMY.js";import{Bb as W,Db as V,Ea as s,Eb as M,Fa as b,Fb as L,Hb as T,Jb as k,Na as u,Sa as _,Ta as S,Ua as d,Vb as B,_ as E,ab as l,bb as o,cb as v,dc as N,e as ae,ec as j,fc as U,ga as g,gb as f,ha as m,hb as h,ia as F,ib as c,ja as A,lc as z,mc as R,tb as p,vb as C,xb as w,yb as P,za as O,zb as y}from"./chunk-MEK6ZYR6.js";var x=ae(le());var oe=n=>["/product",n],ce=(n,t)=>({"bg-green-100 text-green-800":n,"bg-yellow-100 text-yellow-800":t}),de=(n,t)=>({"line-through text-gray-400":n,"text-gray-600":t}),ge=(n,t,e)=>({"opacity-50 cursor-not-allowed":n,"hover:text-red-600":t,"text-red-600":e}),me=(n,t)=>({"bg-[var(--main-color)] text-white border-[var(--main-color)] rounded-full w-10 h-10 flex items-center justify-center":n,"":t});function ue(n,t){n&1&&(l(0,"div",2)(1,"div",3),F(),l(2,"svg",4),v(3,"circle",5)(4,"path",6),o(),A(),l(5,"span",7),p(6,"Loading..."),o()()())}function pe(n,t){if(n&1){let e=f();l(0,"div",22)(1,"input",23),y("ngModelChange",function(r){g(e);let a=c(2);return P(a.searchQuery,r)||(a.searchQuery=r),m(r)}),h("ngModelChange",function(){g(e);let r=c(2);return m(r.applyFilters())}),o()()}if(n&2){let e=c(2);s(),w("ngModel",e.searchQuery)}}function he(n,t){if(n&1){let e=f();l(0,"label",25)(1,"input",28),y("ngModelChange",function(r){g(e);let a=c(3);return P(a.selectedCategory,r)||(a.selectedCategory=r),m(r)}),h("ngModelChange",function(){g(e);let r=c(3);return m(r.applyFilters())}),o(),p(2),o()}if(n&2){let e=t.$implicit,i=c(3);s(),d("value",e),w("ngModel",i.selectedCategory),s(),C(" ",e," ")}}function _e(n,t){if(n&1){let e=f();l(0,"div",24)(1,"label",25)(2,"input",26),y("ngModelChange",function(r){g(e);let a=c(2);return P(a.selectedCategory,r)||(a.selectedCategory=r),m(r)}),h("ngModelChange",function(){g(e);let r=c(2);return m(r.applyFilters())}),o(),p(3," All Categories "),o(),_(4,he,3,3,"label",27),o()}if(n&2){let e=c(2);s(2),w("ngModel",e.selectedCategory),s(2),d("ngForOf",e.categories())}}function fe(n,t){if(n&1){let e=f();l(0,"div",24)(1,"input",29),y("ngModelChange",function(r){g(e);let a=c(2);return P(a.minPrice,r)||(a.minPrice=r),m(r)}),h("ngModelChange",function(){g(e);let r=c(2);return m(r.applyFilters())}),o(),l(2,"input",30),y("ngModelChange",function(r){g(e);let a=c(2);return P(a.maxPrice,r)||(a.maxPrice=r),m(r)}),h("ngModelChange",function(){g(e);let r=c(2);return m(r.applyFilters())}),o()()}if(n&2){let e=c(2);s(),w("ngModel",e.minPrice),s(),w("ngModel",e.maxPrice)}}function ve(n,t){if(n&1){let e=f();l(0,"div",24)(1,"select",31),y("ngModelChange",function(r){g(e);let a=c(2);return P(a.sortOption,r)||(a.sortOption=r),m(r)}),h("ngModelChange",function(){g(e);let r=c(2);return m(r.applyFilters())}),l(2,"option",32),p(3,"Title (A-Z)"),o(),l(4,"option",33),p(5,"Title (Z-A)"),o(),l(6,"option",34),p(7,"Price (Low to High)"),o(),l(8,"option",35),p(9,"Price (High to Low)"),o()()()}if(n&2){let e=c(2);s(),w("ngModel",e.sortOption)}}function xe(n,t){n&1&&(l(0,"div",36),v(1,"i",37),l(2,"p",38),p(3,"No products found"),o()())}function Ce(n,t){if(n&1&&(l(0,"span",53),p(1),T(2,"number"),o()),n&2){let e=c().$implicit;s(),C(" $",k(2,1,e.unitPrice*(1-e.discount/100),"1.2-2")," ")}}function we(n,t){if(n&1){let e=f();l(0,"div",39)(1,"a",40)(2,"img",41),h("error",function(r){g(e);let a=c(2);return m(a.onImageError(r))}),o()(),l(3,"div",42)(4,"div",43)(5,"h5",44),p(6),o(),l(7,"span",45),p(8),o()(),l(9,"div",46)(10,"span",47),p(11,"Status:"),o(),l(12,"span",48),p(13),o()(),l(14,"div",7)(15,"span",49),p(16),T(17,"number"),o(),_(18,Ce,3,4,"span",50),o()(),l(19,"button",51),h("click",function(){let r=g(e).$implicit,a=c(2);return m(a.toggleWishlist(r.id))}),v(20,"i",52),o()()}if(n&2){let e=t.$implicit,i=c(2);s(),d("routerLink",V(16,oe,e.id)),s(),d("src",e.image,O)("alt",e.title),s(),d("routerLink",V(18,oe,e.id)),s(2),d("title",e.title),s(),C(" ",e.title," "),s(2),C(" ",e.categoryName," "),s(4),d("ngClass",M(20,ce,e.status==="Active",e.status==="Pending")),s(),C(" ",e.status," "),s(2),d("ngClass",M(23,de,e.discount>0,e.discount===0)),s(),C(" Price: $",k(17,13,e.unitPrice,"1.2-2")," "),s(2),d("ngIf",e.discount>0),s(),d("ngClass",L(26,ge,!i.userAuthService.isUserLogin.value,i.userAuthService.isUserLogin.value&&!i.isInWishlist(e.id),i.isInWishlist(e.id)))}}function Pe(n,t){if(n&1){let e=f();l(0,"button",61),h("click",function(){let r=g(e).$implicit,a=c(3);return m(a.changePage(r))}),p(1),o()}if(n&2){let e=t.$implicit,i=c(3);d("ngClass",M(2,me,i.currentPage()===e,i.currentPage()!==e)),s(),C(" ",e," ")}}function ye(n,t){if(n&1){let e=f();l(0,"div",54)(1,"nav",55)(2,"button",56),h("click",function(){g(e);let r=c(2);return m(r.changePage(r.currentPage()-1))}),v(3,"i",57),o(),_(4,Pe,2,5,"button",58),l(5,"button",59),h("click",function(){g(e);let r=c(2);return m(r.changePage(r.currentPage()+1))}),v(6,"i",60),o()()()}if(n&2){let e=c(2);s(2),d("disabled",e.currentPage()===1),s(2),d("ngForOf",e.pageNumbers()),s(),d("disabled",e.currentPage()===e.totalPages())}}function be(n,t){if(n&1){let e=f();l(0,"div",8)(1,"aside",9)(2,"h2",10),p(3,"Filters"),o(),l(4,"div",11),_(5,pe,2,1,"div",12),o(),l(6,"div",11)(7,"button",13),h("click",function(){g(e);let r=c();return m(r.toggleCategoryFilter())}),p(8," Category "),v(9,"i",14),o(),_(10,_e,5,2,"div",15),o(),l(11,"div",11)(12,"button",16),h("click",function(){g(e);let r=c();return m(r.togglePriceFilter())}),p(13," Price Range "),v(14,"i",14),o(),_(15,fe,3,2,"div",15),o(),l(16,"div")(17,"button",16),h("click",function(){g(e);let r=c();return m(r.toggleSortFilter())}),p(18," Sort By "),v(19,"i",14),o(),_(20,ve,10,1,"div",15),o()(),l(21,"div",17)(22,"div",18),_(23,xe,4,0,"div",19)(24,we,21,30,"div",20),o(),_(25,ye,7,3,"div",21),o()()}if(n&2){let e=c();s(5),d("ngIf",e.isSearchOpen()),s(4),d("ngClass",e.getArrowClass(e.isCategoryOpen())),S("data-open",e.isCategoryOpen()),s(),d("ngIf",e.isCategoryOpen()),s(4),d("ngClass",e.getArrowClass(e.isPriceOpen())),S("data-open",e.isPriceOpen()),s(),d("ngIf",e.isPriceOpen()),s(4),d("ngClass",e.getArrowClass(e.isSortOpen())),S("data-open",e.isSortOpen()),s(),d("ngIf",e.isSortOpen()),s(3),d("ngIf",e.paginatedProducts().length===0),s(),d("ngForOf",e.paginatedProducts())("ngForTrackBy",e.trackByProductId),s(),d("ngIf",e.paginatedProducts().length!==0)}}var se=class n{constructor(t,e,i,r,a){this.route=t;this.customerService=e;this.userAuthService=i;this.trackingService=r;this.router=a}customerPersonName="";customerId="";decodedToken;merchantId="";products=u([]);filteredProducts=u([]);paginatedProducts=u([]);categories=u([]);selectedCategory=u("");minPrice=u(null);maxPrice=u(null);searchQuery=u("");sortOption=u("title-asc");currentPage=u(1);pageSize=u(9);totalPages=u(1);loading=u(!1);errorMessage=u("");wishlist=u([]);loginSubscription=null;isCategoryOpen=u(!1);isPriceOpen=u(!1);isSearchOpen=u(!0);isSortOpen=u(!1);pageNumbers=B(()=>{let e;this.currentPage()<=this.totalPages()-3?e=this.currentPage():e=Math.max(1,this.totalPages()-3);let i=Math.min(this.totalPages(),e+4-1),r=[];for(let a=e;a<=i;a++)r.push(a);return r});ngOnInit(){this.merchantId=this.route.snapshot.paramMap.get("merchantId")||"";let t=localStorage.getItem("token")||"";t?(this.decodedToken=te(t),this.customerPersonName=this.decodedToken.Name,this.customerId=this.decodedToken.ID):(this.customerId="",this.customerPersonName=""),this.loadProducts(),this.loginSubscription=this.userAuthService.isUserLogin.subscribe(e=>{e&&this.customerId&&this.customerService.loadCartItems(this.customerId)})}loadProducts(){this.loading.set(!0),this.customerService.ShowProductByMerchantId(this.merchantId).subscribe({next:t=>{let e=t.map(i=>({id:i.id,title:i.title,categoryName:i.category,status:i.status,unitPrice:i.unitPrice,discount:i.discount,sellPrice:i.sellPrice,image:i.imageUrl?.startsWith("//")?`https:${i.imageUrl}`:i.imageUrl||"https://fakeimg.pl/300/"}));this.products.set(e),this.filteredProducts.set([...e]),this.updateCategories(),this.applyFilters(),this.loading.set(!1)},error:t=>{this.errorMessage.set(t.error?.message||"Failed to load products"),this.loading.set(!1),this.products.set([]),this.filteredProducts.set([]),this.paginatedProducts.set([]),console.error("Error fetching products:",t)}})}toggleWishlist(t){if(!this.userAuthService.isUserLogin.getValue()){x.default.fire({icon:"warning",title:"Please login first",text:"You need to be logged in to add products to your wishlist.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(e=>{if(e.isConfirmed){let i=this.router.url;localStorage.setItem("returnUrl",i),this.router.navigate(["/login"])}});return}this.isInWishlist(t)?this.customerService.showAllFav(this.customerId).subscribe({next:e=>{let i=e.find(a=>a.productId===t);if(!i){this.wishlist.update(a=>a.filter(I=>I.productId!==t)),this.customerService.removeFromWishlist(t),x.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1});return}let r=i.id;this.customerService.DeleteFromFav(r).subscribe({next:()=>{this.wishlist.update(a=>a.filter(I=>I.productId!==t)),this.customerService.removeFromWishlist(t),x.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})},error:a=>{x.default.fire({icon:"error",title:"Error",text:"Failed to remove product from wishlist."}),console.error("Error removing from wishlist:",a)}})},error:e=>{e.status===404?(this.wishlist.update(i=>i.filter(r=>r.productId!==t)),this.trackingService.trackEvent(this.customerId,t,"remove_from_wishlist"),this.customerService.removeFromWishlist(t),x.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})):(x.default.fire({icon:"error",title:"Error",text:"Failed to fetch wishlist for removal."}),console.error("Error fetching wishlist for removal:",e))}}):this.customerService.AddToFav(this.customerId,t).subscribe({next:e=>{let i=e?.id||Date.now();this.trackingService.trackEvent(this.customerId,t,"add_to_wishlist"),this.customerService.addToWishlist({productId:t,favId:i}),x.default.fire({icon:"success",title:"Added",text:"Product added to wishlist!",timer:1500,showConfirmButton:!1})},error:e=>{x.default.fire({icon:"error",title:"Error",text:"Failed to add product to wishlist."}),console.error("Error adding to wishlist:",e)}})}isInWishlist(t){return this.customerService.getWishlist()().some(e=>e.productId===t)}normalizeCategory(t){let e=t.toLowerCase().replace(/-|\s+/g,"");return{shirt:"Shirts",tshirt:"Shirts",tshirts:"Shirts",jeans:"Jeans",denim:"Jeans",pants:"Pants"}[e]||t.charAt(0).toUpperCase()+t.slice(1)}updateCategories(){this.categories.set([...new Set(this.products().map(t=>this.normalizeCategory(t.categoryName)))])}applyFilters(){let t=[...this.products()];this.selectedCategory()&&(t=t.filter(e=>this.normalizeCategory(e.categoryName)===this.selectedCategory())),this.minPrice()!==null&&this.minPrice()>=0&&(t=t.filter(e=>e.sellPrice>=this.minPrice())),this.maxPrice()!==null&&this.maxPrice()>=0&&(t=t.filter(e=>e.sellPrice<=this.maxPrice())),this.searchQuery()&&(t=t.filter(e=>e.title.toLowerCase().includes(this.searchQuery().toLowerCase()))),t=this.sortProducts(t),this.filteredProducts.set(t),this.updatePagination()}sortProducts(t){switch(this.sortOption()){case"title-asc":return t.sort((e,i)=>e.title.localeCompare(i.title));case"title-desc":return t.sort((e,i)=>i.title.localeCompare(e.title));case"sellPrice-asc":return t.sort((e,i)=>e.sellPrice-i.sellPrice);case"sellPrice-desc":return t.sort((e,i)=>i.sellPrice-e.sellPrice);default:return t}}updatePagination(){this.totalPages.set(Math.ceil(this.filteredProducts().length/this.pageSize())),this.currentPage.set(Math.min(this.currentPage(),this.totalPages()||1));let t=(this.currentPage()-1)*this.pageSize();this.paginatedProducts.set(this.filteredProducts().slice(t,t+this.pageSize()))}changePage(t){t>=1&&t<=this.totalPages()&&(this.currentPage.set(t),this.updatePagination())}toggleCategoryFilter(){this.isCategoryOpen.set(!this.isCategoryOpen())}togglePriceFilter(){this.isPriceOpen.set(!this.isPriceOpen())}toggleSortFilter(){this.isSortOpen.set(!this.isSortOpen())}getArrowClass(t){return t?"fa-chevron-up":"fa-chevron-down"}trackByProductId(t,e){return e.id}onImageError(t){let e=t.target;e.src="https://fakeimg.pl/300/"}static \u0275fac=function(e){return new(e||n)(b(D),b(re),b(ie),b(ne),b(Q))};static \u0275cmp=E({type:n,selectors:[["app-merchant-page"]],standalone:!0,features:[W],decls:2,vars:2,consts:[["class","fixed inset-0 flex items-center justify-center bg-white bg-opacity-75 z-50",4,"ngIf"],["class","container mx-auto p-6 flex flex-col lg:flex-row gap-6",4,"ngIf"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-white","bg-opacity-75","z-50"],[1,"flex","flex-col","items-center","gap-3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-10","w-10","text-[var(--main-color)]"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-lg","font-medium","text-gray-600"],[1,"container","mx-auto","p-6","flex","flex-col","lg:flex-row","gap-6"],[1,"w-full","lg:w-1/4","h-fit","bg-white","rounded-lg","shadow-lg","p-6"],[1,"text-2xl","font-bold","mb-6"],[1,"mb-6"],["class","mt-3",4,"ngIf"],[1,"w-full","flex","justify-between","items-center","text-lg","font-semibold","text-gray-700","hover:text-[var(--main-color)]","transition-colors","duration-300",3,"click"],[1,"fa-solid",3,"ngClass"],["class","mt-3 flex flex-col gap-2",4,"ngIf"],[1,"w-full","flex","justify-between","items-center","text-lg","font-semibold","text-gray-600","hover:text-[var(--main-color)]","transition-colors","duration-300",3,"click"],[1,"flex-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-3","gap-6"],["class","col-span-full text-center py-12 animate-pulse",4,"ngIf"],["class","relative cursor-pointer rounded-lg bg-white shadow-md hover:shadow-lg transition-shadow duration-300 transform hover:-translate-y-1",4,"ngFor","ngForOf","ngForTrackBy"],["class","flex justify-center mt-8",4,"ngIf"],[1,"mt-3"],["type","text","placeholder","Search products...",1,"w-full","p-2","border","rounded-lg","focus:outline-0","transition-all","duration-300","hover:border-[var(--main-color)]","focus:border-[var(--main-color)]",3,"ngModelChange","ngModel"],[1,"mt-3","flex","flex-col","gap-2"],[1,"flex","items-center","hover:bg-gray-100","p-1","rounded","transition-all","duration-200"],["type","radio","name","category","value","",1,"mr-2",3,"ngModelChange","ngModel"],["class","flex items-center hover:bg-gray-100 p-1 rounded transition-all duration-200",4,"ngFor","ngForOf"],["type","radio","name","category",1,"mr-2",3,"ngModelChange","value","ngModel"],["type","number","placeholder","Min Price",1,"w-full","p-2","border","rounded-lg","transition-all","duration-300","hover:border-[var(--main-color)]","focus:border-[var(--main-color)]",3,"ngModelChange","ngModel"],["type","number","placeholder","Max Price",1,"w-full","p-2","border","rounded-lg","transition-all","duration-300","hover:border-[var(--main-color)]","focus:border-[var(--main-color)]",3,"ngModelChange","ngModel"],[1,"w-full","p-2","border","rounded-lg","transition-all","duration-300","hover:border-[var(--main-color)]","focus:border-[var(--main-color)]",3,"ngModelChange","ngModel"],["value","title-asc"],["value","title-desc"],["value","sellPrice-asc"],["value","sellPrice-desc"],[1,"col-span-full","text-center","py-12","animate-pulse"],[1,"fa-solid","fa-magnifying-glass","text-4xl","text-gray-400","mb-4"],[1,"text-xl","font-semibold","text-gray-600"],[1,"relative","cursor-pointer","rounded-lg","bg-white","shadow-md","hover:shadow-lg","transition-shadow","duration-300","transform","hover:-translate-y-1"],[1,"block",3,"routerLink"],[1,"rounded-t-lg","w-full","h-72","object-fill",3,"error","src","alt"],[1,"p-4",3,"routerLink"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xl","font-semibold","text-gray-600",3,"title"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-2","mb-2"],[1,"font-semibold","text-xl","text-gray-600"],[1,"px-2","py-1","rounded","text-sm","font-medium",3,"ngClass"],[1,"mr-2",3,"ngClass"],["class","text-green-600 font-semibold ml-2",4,"ngIf"],[1,"absolute","outline-0","right-2","top-2","bg-white","px-2","py-1","border-2","border-transparent","rounded-full","cursor-pointer","transition-colors","duration-300",3,"click","ngClass"],[1,"text-xl","transition-all","duration-300","fa-solid","fa-heart"],[1,"text-green-600","font-semibold","ml-2"],[1,"flex","justify-center","mt-8"],[1,"inline-flex","rounded-lg","p-2"],[1,"px-4","py-2","cursor-pointer","disabled:cursor-not-allowed","transition-colors","duration-200","hover:bg-white","rounded-l-lg",3,"click","disabled"],[1,"fa-solid","fa-chevron-left"],["class","px-4 py-2 cursor-pointer rounded",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"px-4","py-2","cursor-pointer","bg-transparent","disabled:cursor-not-allowed","transition-colors","duration-200","hover:bg-white","rounded-r-lg",3,"click","disabled"],[1,"fa-solid","fa-chevron-right"],[1,"px-4","py-2","cursor-pointer","rounded",3,"click","ngClass"]],template:function(e,i){e&1&&_(0,ue,7,0,"div",0)(1,be,26,14,"div",1),e&2&&(d("ngIf",i.loading()),s(),d("ngIf",!i.loading()))},dependencies:[R,N,j,U,z,ee,X,$,G,Y,K,q,J,Z,H]})};export{se as MerchantPageComponent};
