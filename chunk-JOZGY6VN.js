import{a as H}from"./chunk-JYENWLXZ.js";import{a as G}from"./chunk-I2CVAPWO.js";import{a as R,c as D,h as O,j as $,r as Y,v as z}from"./chunk-BA4ST442.js";import{i as W,k as j,l as N,p as Z,q as k,r as Q}from"./chunk-VGTTCDMY.js";import{$a as P,Bb as B,Db as S,Ea as l,Fa as _,Na as b,Sa as y,Ua as m,_ as T,_a as F,ab as o,bb as n,cb as p,e as X,fc as L,ga as g,gb as C,ha as f,hb as h,ib as u,lb as M,mc as U,tb as c,ub as I,vb as x,xb as A,yb as V,za as E,zb as q}from"./chunk-MEK6ZYR6.js";var d=X(Z());var tt=(s,e)=>e.id,J=s=>["/product",s];function et(s,e){s&1&&(o(0,"div",23),p(1,"div",24),o(2,"p",25),c(3," Loading your cart... "),n()())}function it(s,e){s&1&&(o(0,"div",26),p(1,"i",27),o(2,"p",28),c(3,"Your cart is empty"),n(),o(4,"p",29),c(5,"Start shopping to add items!"),n(),o(6,"a",30),c(7," Shop Now "),n()())}function rt(s,e){if(s&1){let t=C();o(0,"button",57),h("click",function(){g(t);let i=u().$implicit,a=u(2);return f(a.toggleWishlist(i.productId))}),p(1,"i",58),n()}}function ot(s,e){if(s&1){let t=C();o(0,"button",59),h("click",function(){g(t);let i=u().$implicit,a=u(2);return f(a.toggleWishlist(i.productId))}),p(1,"i",60),n()}}function nt(s,e){if(s&1){let t=C();o(0,"div",32)(1,"div",34)(2,"a",35)(3,"img",36),h("error",function(i){g(t);let a=u(2);return f(a.onImageError(i))}),n()(),o(4,"div",37)(5,"div",38)(6,"p",39),c(7),n(),o(8,"p",40),c(9),n(),o(10,"div",41)(11,"span"),c(12," Color: "),o(13,"span",17),c(14),n()(),o(15,"span"),c(16," Size: "),o(17,"span",17),c(18),n()()()(),o(19,"div",42)(20,"div",43)(21,"div",44)(22,"button",45),h("click",function(){let i=g(t).$implicit,a=u(2);return f(a.updateQuantity(i.id,i.quantity-1))}),p(23,"i",46),n(),o(24,"input",47),q("ngModelChange",function(i){let a=g(t).$implicit;return V(a.quantity,i)||(a.quantity=i),f(i)}),h("change",function(){let i=g(t).$implicit,a=u(2);return f(a.updateQuantity(i.id,i.quantity))}),n(),o(25,"button",48),h("click",function(){let i=g(t).$implicit,a=u(2);return f(a.updateQuantity(i.id,i.quantity+1))}),p(26,"i",49),n()()(),o(27,"div",50)(28,"p",51),c(29),n()(),o(30,"div",52)(31,"button",53),h("click",function(){let i=g(t).$implicit,a=u(2);return f(a.removeFromCart(i.id))}),p(32,"i",54),n(),y(33,rt,2,0,"button",55)(34,ot,2,0,"button",56),n()()()()()}if(s&2){let t=e.$implicit,r=u(2);l(2),m("routerLink",S(13,J,t.productId)),l(),M("alt",t.name),m("src",t.image,E),l(3),m("routerLink",S(15,J,t.productId)),l(),x(" ",t.name," "),l(2),x(" ",t.description," "),l(5),I(t.color),l(4),I(t.size),l(4),m("disabled",t.quantity<=1),l(2),A("ngModel",t.quantity),l(5),x(" $",(t.productPrice*t.quantity).toFixed(2)," "),l(4),m("ngIf",r.isInWishlist(t.productId)),l(),m("ngIf",!r.isInWishlist(t.productId))}}function st(s,e){if(s&1&&(o(0,"div",61),c(1),n()),s&2){let t=u(2);l(),x(" ",t.errorMessage()," ")}}function at(s,e){if(s&1&&(o(0,"div",31),F(1,nt,35,17,"div",32,tt),y(3,st,2,1,"div",33),n()),s&2){let t=u();l(),P(t.cartItems()),l(2),m("ngIf",t.errorMessage())}}function lt(s,e){s&1&&(o(0,"span",62),c(1,"Free"),n())}function ct(s,e){if(s&1&&(o(0,"span",17),c(1),n()),s&2){let t=u();l(),x("$",t.shippingCost.toFixed(2),"")}}var K=class s{constructor(e,t,r,i,a){this.route=e;this.customerService=t;this.userAuthService=r;this.router=i;this.TrackingService=a}errorMessage=b("");loading=b(!0);cartItems=b([]);shippingCost=10;wishlist=b([]);customerId="";customerPersonName="";decodedToken;prodId;loginSubscription=null;ngOnInit(){this.userAuthService.isUserLogin.value||(d.default.fire({icon:"info",title:"Not Logged In",text:"You need to log in to view your cart. Would you like to log in now?",confirmButtonText:"Log In",showCancelButton:!0,cancelButtonText:"Go to Home"}).then(t=>{if(t.isConfirmed){let r=this.router.url;localStorage.setItem("returnUrl",r),this.router.navigate(["/login"])}else this.router.navigate(["/home"])}),this.loading.set(!1));let e=localStorage.getItem("token")||"";e?(this.decodedToken=k(e),this.customerPersonName=this.decodedToken.Name,this.customerId=this.decodedToken.ID,this.loadCart(),this.wishlist.set(this.customerService.getWishlist()()),this.loginSubscription=this.userAuthService.isUserLogin.subscribe(t=>{t&&this.customerId&&this.customerService.loadCartItems(this.customerId)})):(this.customerId="",this.customerPersonName="")}getCustomerId(){let e=localStorage.getItem("token")||"";return e?k(e).ID:""}removeFromCart(e){d.default.fire({icon:"warning",title:"Remove Item?",text:"Are you sure you want to remove this item from your cart?",showCancelButton:!0,confirmButtonText:"Yes, Remove",cancelButtonText:"Cancel"}).then(t=>{if(t.isConfirmed){let r=this.router.url;localStorage.setItem("returnUrl",r),this.loading.set(!0),this.getProductId(e),this.customerService.deleteCart(e).subscribe({next:()=>{this.loadCart(),d.default.fire({icon:"success",title:"Removed",text:"Item removed from cart successfully!",timer:1500,showConfirmButton:!1}),this.getProductId(e);let i=this.router.url;this.router.navigateByUrl("/",{skipLocationChange:!0}).then(()=>{this.router.navigate([i])})},error:i=>{this.errorMessage.set("Failed to remove item from cart."),this.loading.set(!1),d.default.fire({icon:"error",title:"Error",text:"Failed to remove item from cart."})}})}})}toggleWishlist(e){if(this.userAuthService.isUserLogin.getValue()){let t=e;this.isInWishlist(t)?this.customerService.showAllFav(this.customerId).subscribe({next:r=>{let i=r.find(v=>v.productId===t);if(!i){this.wishlist.update(v=>v.filter(w=>w.productId!==t)),this.customerService.removeFromWishlist(t),d.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1});return}let a=i.id;this.customerService.DeleteFromFav(a).subscribe({next:()=>{this.wishlist.update(v=>v.filter(w=>w.productId!==t)),this.customerService.removeFromWishlist(t),this.TrackingService.trackEvent(this.getCustomerId(),t,"remove_from_wishlist"),d.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})},error:v=>{d.default.fire({icon:"error",title:"Error",text:"Failed to remove product from wishlist."}),console.error("Error removing from wishlist:",v)}})},error:r=>{r.status===404?(this.wishlist.update(i=>i.filter(a=>a.productId!==t)),this.customerService.removeFromWishlist(t),d.default.fire({icon:"success",title:"Removed",text:"Product removed from wishlist!",timer:1500,showConfirmButton:!1})):(d.default.fire({icon:"error",title:"Error",text:"Failed to fetch wishlist for removal."}),console.error("Error fetching wishlist for removal:",r))}}):this.customerService.AddToFav(this.customerId,t).subscribe({next:r=>{let i=r.productId||Date.now();this.customerService.addToWishlist({productId:t,favId:i}),this.wishlist.update(a=>[...a,{productId:t,favId:i}]),this.TrackingService.trackEvent(this.getCustomerId(),t,"add_to_wishlist"),d.default.fire({icon:"success",title:"Added",text:"Product added to wishlist!",timer:1500,showConfirmButton:!1})},error:r=>{d.default.fire({icon:"error",title:"Error",text:"Failed to add product to wishlist."}),console.error("Error adding to wishlist:",r)}})}else d.default.fire({icon:"warning",title:"Please Log In First",text:"You must log in first to add products to your wishlist.",confirmButtonText:"Go to Login",showCancelButton:!0,cancelButtonText:"Cancel"}).then(t=>{if(t.isConfirmed){let r=this.router.url;localStorage.setItem("returnUrl",r),this.router.navigate(["/login"])}})}isInWishlist(e){return this.customerService.getWishlist()().some(t=>t.productId===e)}loadCart(){this.loading.set(!0);let e=this.getCustomerId();if(!e){this.errorMessage.set("Unable to fetch customer ID."),this.loading.set(!1);return}this.customerService.ShowAllCarts(e).subscribe({next:t=>{let r=this.mapCartResponse(t);this.cartItems.set(r),this.loading.set(!1)},error:t=>{t.status===404?(this.cartItems.set([]),this.errorMessage.set("")):this.errorMessage.set("Failed to load cart."),this.loading.set(!1)}})}updateQuantity(e,t){if(t<1){d.default.fire({icon:"warning",title:"Invalid Quantity",text:"Quantity cannot be less than 1."});return}this.loading.set(!0),this.customerService.updateQuantity(e,t).subscribe({next:()=>{this.loadCart(),d.default.fire({icon:"success",title:"Quantity Updated",text:"Cart quantity updated successfully!",timer:1500,showConfirmButton:!1})},error:r=>{this.errorMessage.set("Failed to update quantity."),this.loading.set(!1),d.default.fire({icon:"error",title:"Error",text:"Failed to update quantity."})}})}getTotalPrice(){return this.cartItems().reduce((e,t)=>{let r=typeof t.productPrice=="number"?t.productPrice:0,i=typeof t.quantity=="number"?t.quantity:0;return e+r*i},0)}checkout(){if(this.cartItems().length>0){let e={items:this.cartItems().map(t=>({id:t.id,image:t.image,name:t.name,color:t.color,size:t.size,price:t.productPrice,quantity:t.quantity})),summary:{subtotal:this.getTotalPrice(),shippingCost:this.isShippingFree()?0:this.shippingCost,total:this.getTotalPrice()+(this.isShippingFree()?0:this.shippingCost)}};localStorage.setItem("checkoutData",JSON.stringify(e)),this.router.navigate(["/billing"])}else d.default.fire({icon:"warning",title:"Empty Cart",text:"Your cart is empty. Add items before checking out.",confirmButtonText:"OK"})}onImageError(e){let t=e.target;t.src="https://fakeimg.pl/300/"}mapCartResponse(e){let t=[],r=e.productIds?.length||0;for(let i=0;i<r;i++)t.push({id:e.id?.[i]??0,productId:e.productIds?.[i]??0,name:e.productsNames?.[i]??"Unknown Product",description:e.productDescribtions?.[i]??"No description",productPrice:e.productPrice?.[i]??0,quantity:e.quantity?.[i]??0,color:e.color?.[i]??"N/A",size:e.size?.[i]??"N/A",image:e.image?.[i]?e.image[i].startsWith("//")?`https:${e.image[i]}`:e.image[i]:"https://fakeimg.pl/300/"});return t}isShippingFree(){return this.getTotalPrice()>=50}getProductId(e){let t=this.getCustomerId();this.customerService.ShowAllCarts(t).subscribe({next:r=>{for(let i of r.id){let a=0;i===e&&(this.prodId=r.productIds[a],this.TrackingService.trackEvent(this.getCustomerId(),this.prodId,"remove_from_cart"))}}})}static \u0275fac=function(t){return new(t||s)(_(W),_(G),_(Q),_(j),_(H))};static \u0275cmp=T({type:s,selectors:[["app-cart"]],standalone:!0,features:[B],decls:36,vars:8,consts:[[1,"bg-gradient-to-b","from-gray-50","to-white","py-12","md:py-16","min-h-screen"],[1,"mx-auto","max-w-7xl","px-4","sm:px-6","lg:px-8"],[1,"flex","flex-col","sm:flex-row","gap-3","sm:items-center","sm:justify-between","mb-8"],[1,"text-3xl","md:text-4xl","font-extrabold","text-gray-900","tracking-tight"],["routerLink","/shop",1,"text-[var(--main-color)]","hover:cursor-pointer","font-black","transition-colors","duration-300"],[1,"fa-solid","fa-arrow-right","ml-2"],[1,"grid","w-fit","sm:w-full","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"lg:col-span-2","space-y-6"],["class","text-center py-16 bg-white rounded-2xl shadow-lg animate-pulse",4,"ngIf"],["class","text-center py-16 bg-white rounded-2xl shadow-lg",4,"ngIf"],["class","space-y-6",4,"ngIf"],[1,"lg:col-span-1"],[1,"bg-white","p-6","rounded-2xl","shadow-lg","sticky","top-4"],[1,"text-xl","font-bold","text-gray-900","mb-4"],[1,"space-y-4"],[1,"flex","justify-between","text-sm"],[1,"text-gray-600"],[1,"font-medium"],["class","font-medium text-green-600",4,"ngIf"],["class","font-medium",4,"ngIf"],[1,"border-gray-200"],[1,"flex","justify-between","text-base","font-bold"],[1,"w-full","mt-6","px-4","py-3","bg-[var(--main-color)]","cursor-pointer","text-white","font-semibold","rounded-full","hover:bg-indigo-700","transition-all","duration-300","shadow-md","hover:shadow-lg","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-center","py-16","bg-white","rounded-2xl","shadow-lg","animate-pulse"],[1,"w-16","h-16","border-4","border-t-indigo-600","border-gray-200","rounded-full","animate-spin","mx-auto"],[1,"text-lg","font-medium","text-gray-600","mt-4"],[1,"text-center","py-16","bg-white","rounded-2xl","shadow-lg"],[1,"fa-solid","fa-cart-shopping","text-5xl","text-gray-300","mb-4"],[1,"text-xl","font-semibold","text-gray-700"],[1,"text-gray-500","mt-2"],["routerLink","/shop",1,"mt-6","inline-block","px-8","py-3","bg-[var(--main-color)]","text-white","font-semibold","rounded-full","hover:bg-indigo-700","transition-all","duration-300","shadow-md","hover:shadow-lg"],[1,"space-y-6"],[1,"bg-white","p-6","rounded-2xl","shadow-md","hover:shadow-xl","transition-all","duration-300","transform","hover:-translate-y-1"],["class","text-red-600 text-center mt-4 bg-red-50 p-4 rounded-lg",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-[120px_1fr_auto]","gap-4","items-center","justify-center","sm:justify-start","sm:items-start"],[1,"flex","items-center","justify-center",3,"routerLink"],[1,"w-28","h-28","object-cover","rounded-xl","shadow-sm",3,"error","src","alt"],[1,"flex","flex-col","sm:flex-row","items-center","sm:items-center","gap-4","w-full"],[1,"space-y-2","flex-1","w-full"],[1,"text-lg","cursor-pointer","text-center","sm:text-left","font-semibold","text-gray-900","hover:text-indigo-600","transition-colors","duration-300",3,"routerLink"],[1,"text-sm","text-center","sm:text-left","text-gray-500","line-clamp-2"],[1,"flex","flex-col","text-center","sm:text-left","gap-1","text-sm","text-gray-600"],[1,"flex","flex-col","flex-1","sm:flex-row","justify-between","gap-5"],[1,"flex","justify-center","w-full","sm:w-auto"],[1,"flex","items-center","gap-2"],["type","button",1,"p-2","hidden","sm:block","rounded-full","bg-gray-100","hover:bg-gray-200","transition-colors","duration-200",3,"click","disabled"],[1,"fa-solid","fa-minus","text-sm","text-gray-600"],["type","number","min","1",1,"w-16","text-center","border","border-gray-300","rounded-md","p-1","text-sm","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500",3,"ngModelChange","change","ngModel"],["type","button",1,"p-2","hidden","sm:block","rounded-full","bg-gray-100","hover:bg-gray-200","transition-colors","duration-200",3,"click"],[1,"fa-solid","fa-plus","text-sm","text-gray-600"],[1,"flex","justify-center","items-center","gap-4"],[1,"text-lg","font-bold","text-gray-900","min-w-[80px]"],[1,"flex","justify-center","gap-2","text-sm"],["type","button",1,"cursor-pointer","text-red-600","hover:text-red-800","transition-colors","duration-200","flex","items-center","gap-3",3,"click"],[1,"fa-solid","fa-trash","text-2xl"],["type","button","class","cursor-pointer text-red-600 transition-colors duration-200 flex items-center gap-3",3,"click",4,"ngIf"],["type","button","class","cursor-pointer text-black transition-colors duration-200 flex items-center gap-1",3,"click",4,"ngIf"],["type","button",1,"cursor-pointer","text-red-600","transition-colors","duration-200","flex","items-center","gap-3",3,"click"],[1,"fa-solid","fa-heart-crack","text-2xl"],["type","button",1,"cursor-pointer","text-black","transition-colors","duration-200","flex","items-center","gap-1",3,"click"],[1,"fa-solid","fa-heart","text-2xl"],[1,"text-red-600","text-center","mt-4","bg-red-50","p-4","rounded-lg"],[1,"font-medium","text-green-600"]],template:function(t,r){t&1&&(o(0,"section",0)(1,"div",1)(2,"div",2)(3,"h2",3),c(4," Your Shopping Cart "),n(),o(5,"a",4),c(6," Continue Shopping "),p(7,"i",5),n()(),o(8,"div",6)(9,"div",7),y(10,et,4,0,"div",8)(11,it,8,0,"div",9)(12,at,4,1,"div",10),n(),o(13,"div",11)(14,"div",12)(15,"h3",13),c(16,"Order Summary"),n(),o(17,"div",14)(18,"div",15)(19,"span",16),c(20,"Subtotal"),n(),o(21,"span",17),c(22),n()(),o(23,"div",15)(24,"span",16),c(25,"Shipping"),n(),y(26,lt,2,0,"span",18)(27,ct,2,1,"span",19),n(),p(28,"hr",20),o(29,"div",21)(30,"span"),c(31,"Total"),n(),o(32,"span"),c(33),n()()(),o(34,"button",22),h("click",function(){return r.checkout()}),c(35," Proceed to Checkout "),n()()()()()()),t&2&&(l(10),m("ngIf",r.loading()),l(),m("ngIf",!r.loading()&&r.cartItems().length===0),l(),m("ngIf",!r.loading()&&r.cartItems().length>0),l(10),x("$",r.getTotalPrice().toFixed(2),""),l(4),m("ngIf",r.isShippingFree()),l(),m("ngIf",!r.isShippingFree()),l(6),x("$",(r.getTotalPrice()+(r.isShippingFree()?0:r.shippingCost)).toFixed(2),""),l(),m("disabled",r.loading()||r.cartItems().length===0))},dependencies:[U,L,z,R,$,D,Y,O,N],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-out forwards}button.rounded-full[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}img[_ngcontent-%COMP%]{transition:opacity .3s ease}img.loading[_ngcontent-%COMP%]{opacity:.5}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"]})};export{K as CartComponent};
