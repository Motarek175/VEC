import{k as A,p as F,q as D,r as k}from"./chunk-VGTTCDMY.js";import{Bb as P,Ea as l,Fa as p,Hb as _,Ib as E,Kb as y,Na as I,Sa as u,Ua as m,_ as g,ab as i,bb as o,cb as c,e as L,fc as C,ga as h,gb as b,ha as x,hb as w,ib as f,ic as N,mc as T,sb as S,tb as n,ub as a,za as v}from"./chunk-MEK6ZYR6.js";var s=L(F());function M(r,t){r&1&&(i(0,"div",3),c(1,"div",4),o())}function R(r,t){if(r&1){let e=b();i(0,"div",7)(1,"h2",8),n(2," My Profile "),o(),i(3,"div",9),c(4,"img",10),_(5,"async"),i(6,"label",11),c(7,"i",12),o(),i(8,"input",13),w("change",function(B){h(e);let U=f(2);return x(U.onImageSelected(B))}),o()(),i(9,"div",14)(10,"div",15)(11,"span",16),n(12,"Name:"),o(),i(13,"span",17),n(14),o()(),i(15,"div",15)(16,"span",16),n(17,"Email:"),o(),i(18,"span",17),n(19),o()(),i(20,"div",15)(21,"span",16),n(22,"Phone:"),o(),i(23,"span",17),n(24),o()(),i(25,"div",15)(26,"span",16),n(27,"Governorate:"),o(),i(28,"span",17),n(29),o()(),i(30,"div",15)(31,"span",16),n(32,"Location:"),o(),i(33,"span",17),n(34),o()(),i(35,"div",15)(36,"span",16),n(37,"State:"),o(),i(38,"span",17),n(39),o()()()()}if(r&2){let e=f(2);l(4),m("src",E(5,7,e.userAuthService.profilePicture),v),l(10),a(e.profileInfo.name||"Not provided"),l(5),a(e.profileInfo.email||"Not provided"),l(5),a(e.profileInfo.phone||"Not provided"),l(5),a(e.profileInfo.governorate||"Not provided"),l(5),a(e.profileInfo.location||"Not provided"),l(5),a(e.profileInfo.state||"Not provided")}}function $(r,t){r&1&&(i(0,"div",18)(1,"p"),n(2,"No profile data available."),o()())}function O(r,t){if(r&1&&(i(0,"div",5),u(1,R,40,9,"div",6)(2,$,3,0,"ng-template",null,0,y),o()),r&2){let e=S(3),d=f();l(),m("ngIf",d.profileInfo)("ngIfElse",e)}}var j=class r{constructor(t,e){this.userAuthService=t;this.router=e}loading=I(!0);customerId="";customerPersonName="";decodedToken;profileInfo=null;selectedImage=null;ngOnInit(){if(!this.userAuthService.isUserLogin.value){this.handleNotLoggedIn();return}let t=localStorage.getItem("token");t?(this.decodedToken=D(t),this.customerPersonName=this.decodedToken.Name||"",this.customerId=this.decodedToken.ID||"",this.loadProfileInfo()):this.loading.set(!1)}handleNotLoggedIn(){s.default.fire({icon:"info",title:"Not Logged In",text:"You need to log in to view your profile. Would you like to log in now?",confirmButtonText:"Log In",showCancelButton:!0,cancelButtonText:"Go to Home"}).then(t=>{if(t.isConfirmed){let e=this.router.url;localStorage.setItem("returnUrl",e),this.router.navigate(["/login"])}else this.router.navigate(["/home"])}),this.loading.set(!1)}loadProfileInfo(){if(!this.customerId){this.loading.set(!1);return}this.loading.set(!0),this.userAuthService.ProfileInfo(this.customerId).subscribe({next:t=>{this.profileInfo=t,this.loading.set(!1),this.userAuthService.profilePicture.next(`${t.image}?v=${Date.now()}`)},error:t=>{this.loading.set(!1),this.profileInfo=null,s.default.fire({title:"Error",text:"Failed to load profile information.",icon:"error",confirmButtonColor:"#ef4444"}),console.error("Profile Error:",t)}})}onImageSelected(t){let e=t.target;e.files&&e.files.length>0&&(this.selectedImage=e.files[0],this.updateProfilePicture(),e.value="")}updateProfilePicture(){if(!this.selectedImage||!this.customerId){s.default.fire({title:"Error",text:"Please select an image and ensure you are logged in.",icon:"error",confirmButtonColor:"#ef4444"});return}this.loading.set(!0);let t=new FormData;t.append("image",this.selectedImage),this.userAuthService.updateProfilePic(this.customerId,t).subscribe({next:e=>{this.loading.set(!1),s.default.fire({title:"Success",text:"Profile picture updated successfully!",icon:"success",confirmButtonColor:"#22c55e"}).then(()=>{this.userAuthService.profilePicture.next(`${e.image}?v=${Date.now()}`),this.loadProfileInfo()})},error:e=>{this.loading.set(!1),s.default.fire({title:"Error",text:"Failed to update profile picture.",icon:"error",confirmButtonColor:"#ef4444"}),console.error("Update Error:",e)}})}static \u0275fac=function(e){return new(e||r)(p(k),p(A))};static \u0275cmp=g({type:r,selectors:[["app-profile"]],standalone:!0,features:[P],decls:2,vars:2,consts:[["noDataTemplate",""],["class","flex items-center justify-center min-h-screen bg-white",4,"ngIf"],["class","mx-auto px-4 py-12 sm:px-6 lg:px-8 min-h-screen flex items-center justify-center bg-white",4,"ngIf"],[1,"flex","items-center","justify-center","min-h-screen","bg-white"],[1,"animate-spin","rounded-full","h-16","w-16","border-t-4","border-b-4","border-[#a14b4b]"],[1,"mx-auto","px-4","py-12","sm:px-6","lg:px-8","min-h-screen","flex","items-center","justify-center","bg-white"],["class","bg-white/20 backdrop-blur-md p-6 md:p-8 rounded-2xl shadow-xl w-full max-w-3xl border border-gray-200 transform transition-all duration-300 hover:shadow-2xl",4,"ngIf","ngIfElse"],[1,"bg-white/20","backdrop-blur-md","p-6","md:p-8","rounded-2xl","shadow-xl","w-full","max-w-3xl","border","border-gray-200","transform","transition-all","duration-300","hover:shadow-2xl"],[1,"text-3xl","md:text-4xl","font-bold","text-center","text-gray-800","bg-clip-text","text-transparent","bg-gradient-to-r","from-[#703232]","to-[#a14b4b]","mb-8"],[1,"relative","w-36","h-36","md:w-48","md:h-48","mx-auto","mb-6"],["alt","Profile Image",1,"w-full","h-full","object-cover","rounded-full","border-4","border-[#a14b4b]/30","shadow-md","transition-transform","duration-300","hover:scale-105",3,"src"],["for","imageInput",1,"absolute","bottom-2","right-2","bg-[#a14b4b]/70","text-white","rounded-full","p-2","cursor-pointer","hover:bg-[#703232]","transition-colors","duration-200"],[1,"fas","fa-pencil-alt"],["type","file","id","imageInput","accept","image/*",1,"hidden",3,"change"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-6"],[1,"p-4","bg-white/10","rounded-lg","shadow-md","hover:bg-white/20","transition-colors","duration-200"],[1,"text-gray-700","font-medium"],[1,"text-gray-900","font-semibold","ml-2"],[1,"text-center","text-gray-600","p-6","bg-white/10","rounded-xl","shadow-md"]],template:function(e,d){e&1&&u(0,M,2,0,"div",1)(1,O,4,2,"div",2),e&2&&(m("ngIf",d.loading()),l(),m("ngIf",!d.loading()))},dependencies:[T,C,N]})};export{j as ProfileComponent};
